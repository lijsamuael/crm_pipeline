import{N as ie,$ as _e,O as ue,y as ee,a0 as Ce,z as we,l as w,e as j,f as a,c as i,b as u,w as v,u as c,F as te,r as xe,g as k,n as P,B as p,Y as se,d as V,t as h,a1 as pe,m as he,a2 as G}from"./index-a094f868.js";import{_ as Le}from"./ViewBreadcrumbs-f07dae54.js";import{_ as fe}from"./MultipleAvatar-d9f4a074.js";import{_ as Ve}from"./CustomActions-d3cf25f1.js";import{E as $e}from"./EmailAtIcon-1133d17b.js";import{P as le}from"./PhoneIcon-70b3a745.js";import{_ as Me,N as re}from"./NoteModal-848b61de.js";import{T as de}from"./TaskIcon-78f92ad5.js";import{C as ze}from"./CommentIcon-2282205d.js";import{I as Q}from"./IndicatorIcon-466bb833.js";import{L as Ue}from"./LeadsIcon-bb4322a7.js";import{L as Ae}from"./LayoutHeader-027ebcdc.js";import{H as ce,_ as Te}from"./ListBulkActions-d30e952b.js";import{_ as Re,a as Be,b as De,c as Ie,d as Pe,e as Se}from"./DeleteLinkedDocModal-25cd8320.js";import{a as U,D as me,b as Ee,u as We,f as Y,w as qe,t as N,d as je}from"./index-2d68a6a0.js";import{_ as Oe}from"./ListFooter-8058fa68.js";import{_ as He}from"./KanbanView-02bf94c0.js";import{_ as Ke}from"./LeadModal-26229f4d.js";import{T as Je}from"./TaskModal-03afb2a1.js";import{_ as Ge}from"./ViewControls-c5479b53.js";import{g as Ye}from"./global-c1d3e1d5.js";import{s as Qe}from"./statuses-dc79e6cb.js";import{c as Xe}from"./DragVerticalIcon-12e66a71.js";import"./Icon-5431cc70.js";import"./ArrowUpRightIcon-9ddf39c9.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-e2f7307d.js";import"./helpCenter-6244f2ec.js";import"./Link-3cfde2ee.js";import"./EditIcon-d7d50f24.js";import"./TabButtons-66363a13.js";import"./description-ce5058e0.js";import"./FieldLayout-9e608d31.js";import"./modals-e23741cc.js";import"./FadedScrollableDiv-0eedb39b.js";import"./IconPicker-1152affd.js";import"./PinIcon-5c436e1e.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-8c23e9ea.js";import"./DetailsIcon-848d2598.js";import"./settings-6524f74f.js";import"./pageMeta-ccf84976.js";const Ze={key:0,class:"flex items-center"},Fe={key:0},Ne={key:1},et={key:2},tt={key:3},st=["onClick"],lt={key:1},at={key:2,class:"truncate text-base"},ot={key:3},nt=["onClick"],it={__name:"LeadsListView",props:ie({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:ie(["loadMore","updatePageCount","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc","selectionsChanged"],["update:modelValue","update:list"]),setup(g,{expose:X,emit:Z}){const C=Z,O=_e(),$=ue(g,"modelValue"),B=ue(g,"list"),S=ee(()=>{var n,f;return!!((f=(n=B.value.params)==null?void 0:n.filters)!=null&&f._liked_by)}),{user:E}=Ce();function M(n){if(n)return JSON.parse(n).includes(E)}we($,(n,f)=>{n!==f&&C("updatePageCount",n)});const D=w(null);return X({customListActions:ee(()=>{var n;return(n=D.value)==null?void 0:n.customListActions})}),(n,f)=>{const A=j("Button"),W=j("Badge"),L=j("FormControl");return a(),i(te,null,[u(c(Se),{class:P(n.$attrs.class),columns:g.columns,rows:g.rows,options:{getRowRoute:l=>({name:"Lead",params:{leadId:l.name},query:{view:c(O).query.view,viewType:c(O).params.viewType}}),selectable:g.options.selectable,showTooltip:g.options.showTooltip,resizeColumn:g.options.resizeColumn},"row-key":"name","onUpdate:selections":f[2]||(f[2]=l=>C("selectionsChanged",l))},{default:v(()=>[u(c(Re),{class:"sm:mx-5 mx-3",onColumnWidthUpdated:f[1]||(f[1]=l=>C("columnWidthUpdated"))},{default:v(()=>[(a(!0),i(te,null,xe(g.columns,l=>(a(),k(c(Be),{key:l.key,item:l,onColumnWidthUpdated:m=>C("columnWidthUpdated",l)},{default:v(()=>[l.key=="_liked_by"?(a(),k(A,{key:0,variant:"ghosted",class:P(["!h-4",S.value?"fill-red-500":"fill-white"]),onClick:f[0]||(f[0]=()=>C("applyLikeFilter"))},{default:v(()=>[u(ce,{class:"h-4 w-4"})]),_:1},8,["class"])):p("",!0)]),_:2},1032,["item","onColumnWidthUpdated"]))),128))]),_:1}),u(De,{rows:g.rows,doctype:"CRM Lead"},{default:v(({idx:l,column:m,item:_,row:F})=>[m.key==="_assign"?(a(),i("div",Ze,[u(fe,{avatars:_,size:"sm",onClick:T=>C("applyFilter",{event:T,idx:l,column:m,item:_,firstColumn:g.columns[0]})},null,8,["avatars","onClick"])])):(a(),k(c(Ie),{key:1,item:_,align:m.align},{prefix:v(()=>[m.key==="status"?(a(),i("div",Fe,[u(Q,{class:P(_.color)},null,8,["class"])])):m.key==="lead_name"?(a(),i("div",Ne,[_.label?(a(),k(c(U),{key:0,class:"flex items-center",image:_.image,label:_.image_label,size:"sm"},null,8,["image","label"])):p("",!0)])):m.key==="lead_owner"?(a(),i("div",et,[_.full_name?(a(),k(c(U),{key:0,class:"flex items-center",image:_.user_image,label:_.full_name,size:"sm"},null,8,["image","label"])):p("",!0)])):m.key==="mobile_no"?(a(),i("div",tt,[u(le,{class:"h-4 w-4"})])):p("",!0)]),default:v(({label:T})=>[["modified","creation","first_response_time","first_responded_on","response_by"].includes(m.key)?(a(),i("div",{key:0,class:"truncate text-base",onClick:R=>C("applyFilter",{event:R,idx:l,column:m,item:_,firstColumn:g.columns[0]})},[u(c(se),{text:_.label},{default:v(()=>[V("div",null,h(_.timeAgo),1)]),_:2},1032,["text"])],8,st)):m.key==="_liked_by"?(a(),i("div",lt,[m.key=="_liked_by"?(a(),k(A,{key:0,variant:"ghosted",class:P(M(_)?"fill-red-500":"fill-white"),onClick:pe(()=>C("likeDoc",{name:F.name,liked:M(_)}),["stop","prevent"])},{default:v(()=>[u(ce,{class:"h-4 w-4"})]),_:1},8,["class","onClick"])):p("",!0)])):m.key==="sla_status"?(a(),i("div",at,[_.value?(a(),k(W,{key:0,variant:"subtle",theme:_.color,size:"md",label:_.value,onClick:R=>C("applyFilter",{event:R,idx:l,column:m,item:_,firstColumn:g.columns[0]})},null,8,["theme","label","onClick"])):p("",!0)])):m.type==="Check"?(a(),i("div",ot,[u(L,{type:"checkbox",modelValue:_,disabled:!0,class:"text-ink-gray-9"},null,8,["modelValue"])])):(a(),i("div",{key:4,class:"truncate text-base",onClick:R=>C("applyFilter",{event:R,idx:l,column:m,item:_,firstColumn:g.columns[0]})},h(T),9,nt))]),_:2},1032,["item","align"]))]),_:1},8,["rows"]),u(c(Pe),null,{actions:v(({selections:l,unselectAll:m})=>[u(c(me),{options:D.value.bulkActions(l,m)},{default:v(()=>[u(A,{icon:"more-horizontal",variant:"ghost"})]),_:1},8,["options"])]),_:1})]),_:1},8,["class","columns","rows","options"]),$.value?(a(),k(c(Oe),{key:0,class:"border-t sm:px-5 px-3 py-2",modelValue:$.value,"onUpdate:modelValue":f[3]||(f[3]=l=>$.value=l),options:{rowCount:g.options.rowCount,totalCount:g.options.totalCount},onLoadMore:f[4]||(f[4]=l=>C("loadMore"))},null,8,["modelValue","options"])):p("",!0),u(Te,{ref_key:"listBulkActionsRef",ref:D,modelValue:B.value,"onUpdate:modelValue":f[5]||(f[5]=l=>B.value=l),doctype:"CRM Lead"},null,8,["modelValue"])],64)}}},ut={class:"flex items-center gap-2"},rt={key:0},dt={key:1},ct={key:2},_t={key:3},pt={key:4},ft={key:5,class:"truncate text-base"},mt={key:6,class:"truncate text-base"},vt={key:7,class:"truncate text-base"},yt={key:8,class:"text-ink-gray-4"},kt={key:0,class:"truncate flex items-center gap-2"},bt={key:0},gt={key:1},Ct={key:2},wt={key:3},xt={key:4,class:"truncate text-base"},ht={key:5,class:"truncate text-base"},Lt={key:6,class:"flex items-center"},Vt={key:7,class:"truncate text-base"},$t={class:"flex gap-2 items-center justify-between"},Mt={class:"text-ink-gray-5 flex items-center gap-1.5"},zt={key:0},Ut={key:1},At={key:2},Tt={key:3},Rt={key:2,class:"flex h-full items-center justify-center"},Bt={class:"flex flex-col items-center gap-3 text-xl font-medium text-ink-gray-4"},Cs={__name:"Leads",setup(g){const{getFormattedPercent:X,getFormattedFloat:Z,getFormattedCurrency:C}=Ee("CRM Lead"),{makeCall:O}=Ye(),{getUser:$}=We(),{getLeadStatus:B}=Qe(),S=_e(),E=w(null),M=w(!1),D=he({}),n=w({}),f=w(1),A=w(1),W=w(20),L=w(null);function l(r,s){var y;function b(e){return e&&typeof e=="object"&&!Array.isArray(e)?e:{label:e}}return b((y=m.value)==null?void 0:y.find(e=>e.name==r)[s])}const m=ee(()=>{var r,s,b,y,e,t,d;return(s=(r=n.value)==null?void 0:r.data)!=null&&s.data?n.value.data.view_type==="group_by"?(y=(b=n.value)==null?void 0:b.data.group_by_field)!=null&&y.fieldname?_((e=n.value)==null?void 0:e.data.data,(t=n.value)==null?void 0:t.data.group_by_field,n.value.data.columns):[]:n.value.data.view_type==="kanban"?F(n.value.data.data,n.value.data.fields):T((d=n.value)==null?void 0:d.data.data,n.value.data.columns):[]});function _(r,s,b){var e;let y=[];return(e=s.options)==null||e.forEach(t=>{let d=[];t?d=r.filter(o=>o[s.fieldname]==t):d=r.filter(o=>!o[s.fieldname]);let q={label:s.label,group:t||__(" "),collapsed:!1,rows:T(d,b)};s.fieldname=="status"&&(q.icon=()=>{var o;return G(Q,{class:(o=B(t))==null?void 0:o.color})}),y.push(q)}),y||r}function F(r,s){let b=[];return r.forEach(y=>{var e;(e=y.data)==null||e.forEach(t=>{b.push(t)})}),T(b,s)}function T(r,s=[]){let b=n.value.data.view_type,y=b==="kanban"?"fieldname":"key",e=b==="kanban"?"fieldtype":"type";return r.map(t=>{var q;let d={};return(q=n.value)==null||q.data.rows.forEach(o=>{var ae,oe;d[o]=t[o];let z=(ae=s==null?void 0:s.find(x=>(x[y]||x.value)==o))==null?void 0:ae[e];if(z&&["Date","Datetime"].includes(z)&&!["modified","creation"].includes(o)&&(d[o]=Y(t[o],"",!0,z=="Datetime")),z&&z=="Currency"&&(d[o]=C(o,t)),z&&z=="Float"&&(d[o]=Z(o,t)),z&&z=="Percent"&&(d[o]=X(o,t)),o=="lead_name")d[o]={label:t.lead_name,image:t.image,image_label:t.first_name};else if(o=="organization")d[o]=t.organization;else if(o==="website")d[o]=qe(t.website);else if(o=="status")d[o]={label:t.status,color:(oe=B(t.status))==null?void 0:oe.color};else if(o=="sla_status"){let x=t.sla_status,I=x,ne=t.sla_status=="Failed"?"red":t.sla_status=="Fulfilled"?"green":"orange";x=="First Response Due"&&(x=__(N(t.response_by)),I=Y(t.response_by),new Date(t.response_by)<new Date&&(ne="red")),d[o]={label:I,value:x,color:ne}}else if(o=="lead_owner")d[o]={label:t.lead_owner&&$(t.lead_owner).full_name,...t.lead_owner&&$(t.lead_owner)};else if(o=="_assign"){let x=JSON.parse(t._assign||"[]");d[o]=x.map(I=>({name:I,image:$(I).user_image,label:$(I).full_name}))}else if(["modified","creation"].includes(o))d[o]={label:Y(t[o]),timeAgo:__(N(t[o]))};else if(["first_response_time","first_responded_on","response_by"].includes(o)){let x=o=="response_by"?"response_by":"first_responded_on";d[o]={label:t[x]?Y(t[x]):"",timeAgo:t[o]?o=="first_response_time"?je(t[o]):__(N(t[o])):""}}}),d._email_count=t._email_count,d._note_count=t._note_count,d._task_count=t._task_count,d._comment_count=t._comment_count,d})}function R(r){let s=n.value.params.column_field;s&&(D[s]=r.column.name),M.value=!0}function ve(r){var y;let s=((y=l(r,"mobile_no"))==null?void 0:y.label)||"";return[{icon:G(le,{class:"h-4 w-4"}),label:__("Make a Call"),onClick:()=>O(s),condition:()=>s&&Xe.value},{icon:G(re,{class:"h-4 w-4"}),label:__("New Note"),onClick:()=>ke(r)},{icon:G(de,{class:"h-4 w-4"}),label:__("New Task"),onClick:()=>ge(r)}].filter(e=>e.condition?e.condition():!0)}const H=w(""),K=w(!1),ye=w({title:"",content:""});function ke(r){H.value=r,K.value=!0}const J=w(!1),be=w({title:"",description:"",assigned_to:"",due_date:"",priority:"Low",status:"Backlog"});function ge(r){H.value=r,J.value=!0}return(r,s)=>{const b=j("Button"),y=j("Badge");return a(),i(te,null,[u(Ae,null,{"left-header":v(()=>[u(Le,{modelValue:L.value,"onUpdate:modelValue":s[0]||(s[0]=e=>L.value=e),routeName:"Leads"},null,8,["modelValue"])]),"right-header":v(()=>{var e;return[(e=E.value)!=null&&e.customListActions?(a(),k(Ve,{key:0,actions:E.value.customListActions},null,8,["actions"])):p("",!0),u(b,{variant:"solid",label:r.__("Create"),iconLeft:"plus",onClick:s[1]||(s[1]=t=>M.value=!0)},null,8,["label"])]}),_:1}),u(Ge,{ref_key:"viewControls",ref:L,modelValue:n.value,"onUpdate:modelValue":s[2]||(s[2]=e=>n.value=e),loadMore:f.value,"onUpdate:loadMore":s[3]||(s[3]=e=>f.value=e),resizeColumn:A.value,"onUpdate:resizeColumn":s[4]||(s[4]=e=>A.value=e),updatedPageCount:W.value,"onUpdate:updatedPageCount":s[5]||(s[5]=e=>W.value=e),doctype:"CRM Lead",filters:{converted:0},options:{allowedViews:["list","group_by","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),c(S).params.viewType=="kanban"?(a(),k(He,{key:0,modelValue:n.value,"onUpdate:modelValue":s[7]||(s[7]=e=>n.value=e),options:{getRoute:e=>({name:"Lead",params:{leadId:e.name},query:{view:c(S).query.view,viewType:c(S).params.viewType}}),onNewClick:e=>R(e)},onUpdate:s[8]||(s[8]=e=>L.value.updateKanbanSettings(e)),onLoadMore:s[9]||(s[9]=e=>L.value.loadMoreKanban(e))},{title:v(({titleField:e,itemName:t})=>[V("div",ut,[e==="status"?(a(),i("div",rt,[u(Q,{class:P(l(t,e).color)},null,8,["class"])])):e==="organization"&&l(t,e).label?(a(),i("div",dt,[u(c(U),{class:"flex items-center",image:l(t,e).logo,label:l(t,e).label,size:"sm"},null,8,["image","label"])])):e==="lead_name"&&l(t,e).label?(a(),i("div",ct,[u(c(U),{class:"flex items-center",image:l(t,e).image,label:l(t,e).image_label,size:"sm"},null,8,["image","label"])])):e==="lead_owner"&&l(t,e).full_name?(a(),i("div",_t,[u(c(U),{class:"flex items-center",image:l(t,e).user_image,label:l(t,e).full_name,size:"sm"},null,8,["image","label"])])):e==="mobile_no"?(a(),i("div",pt,[u(le,{class:"h-4 w-4"})])):p("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(a(),i("div",ft,[u(c(se),{text:l(t,e).label},{default:v(()=>[V("div",null,h(l(t,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(a(),i("div",mt,[l(t,e).value?(a(),k(y,{key:0,variant:"subtle",theme:l(t,e).color,size:"md",label:l(t,e).value},null,8,["theme","label"])):p("",!0)])):l(t,e).label?(a(),i("div",vt,h(l(t,e).label),1)):(a(),i("div",yt,h(r.__("No Title")),1))])]),fields:v(({fieldName:e,itemName:t})=>[l(t,e).label?(a(),i("div",kt,[e==="status"?(a(),i("div",bt,[u(Q,{class:P(l(t,e).color)},null,8,["class"])])):e==="organization"&&l(t,e).label?(a(),i("div",gt,[u(c(U),{class:"flex items-center",image:l(t,e).logo,label:l(t,e).label,size:"xs"},null,8,["image","label"])])):e==="lead_name"?(a(),i("div",Ct,[l(t,e).label?(a(),k(c(U),{key:0,class:"flex items-center",image:l(t,e).image,label:l(t,e).image_label,size:"xs"},null,8,["image","label"])):p("",!0)])):e==="lead_owner"?(a(),i("div",wt,[l(t,e).full_name?(a(),k(c(U),{key:0,class:"flex items-center",image:l(t,e).user_image,label:l(t,e).full_name,size:"xs"},null,8,["image","label"])):p("",!0)])):p("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(a(),i("div",xt,[u(c(se),{text:l(t,e).label},{default:v(()=>[V("div",null,h(l(t,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(a(),i("div",ht,[l(t,e).value?(a(),k(y,{key:0,variant:"subtle",theme:l(t,e).color,size:"md",label:l(t,e).value},null,8,["theme","label"])):p("",!0)])):e==="_assign"?(a(),i("div",Lt,[u(fe,{avatars:l(t,e).label,size:"xs"},null,8,["avatars"])])):(a(),i("div",Vt,h(l(t,e).label),1))])):p("",!0)]),actions:v(({itemName:e})=>[V("div",$t,[V("div",Mt,[u($e,{class:"h-4 w-4"}),l(e,"_email_count").label?(a(),i("span",zt,h(l(e,"_email_count").label),1)):p("",!0),s[23]||(s[23]=V("span",{class:"text-3xl leading-[0]"}," · ",-1)),u(re,{class:"h-4 w-4"}),l(e,"_note_count").label?(a(),i("span",Ut,h(l(e,"_note_count").label),1)):p("",!0),s[24]||(s[24]=V("span",{class:"text-3xl leading-[0]"}," · ",-1)),u(de,{class:"h-4 w-4"}),l(e,"_task_count").label?(a(),i("span",At,h(l(e,"_task_count").label),1)):p("",!0),s[25]||(s[25]=V("span",{class:"text-3xl leading-[0]"}," · ",-1)),u(ze,{class:"h-4 w-4"}),l(e,"_comment_count").label?(a(),i("span",Tt,h(l(e,"_comment_count").label),1)):p("",!0)]),u(c(me),{class:"flex items-center gap-2",options:ve(e),variant:"ghost",onClick:s[6]||(s[6]=pe(()=>{},["stop","prevent"]))},{default:v(()=>[u(b,{icon:"plus",variant:"ghost"})]),_:1},8,["options"])])]),_:1},8,["modelValue","options"])):n.value.data&&m.value.length?(a(),k(it,{key:1,ref_key:"leadsListView",ref:E,modelValue:n.value.data.page_length_count,"onUpdate:modelValue":s[10]||(s[10]=e=>n.value.data.page_length_count=e),list:n.value,"onUpdate:list":s[11]||(s[11]=e=>n.value=e),rows:m.value,columns:n.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:n.value.data.row_count,totalCount:n.value.data.total_count},onLoadMore:s[12]||(s[12]=()=>f.value++),onColumnWidthUpdated:s[13]||(s[13]=()=>A.value++),onUpdatePageCount:s[14]||(s[14]=e=>W.value=e),onApplyFilter:s[15]||(s[15]=e=>L.value.applyFilter(e)),onApplyLikeFilter:s[16]||(s[16]=e=>L.value.applyLikeFilter(e)),onLikeDoc:s[17]||(s[17]=e=>L.value.likeDoc(e)),onSelectionsChanged:s[18]||(s[18]=e=>L.value.updateSelections(e))},null,8,["modelValue","list","rows","columns","options"])):n.value.data?(a(),i("div",Rt,[V("div",Bt,[u(Ue,{class:"h-10 w-10"}),V("span",null,h(r.__("No {0} Found",[r.__("Leads")])),1),u(b,{label:r.__("Create"),iconLeft:"plus",onClick:s[19]||(s[19]=e=>M.value=!0)},null,8,["label"])])])):p("",!0),M.value?(a(),k(Ke,{key:3,modelValue:M.value,"onUpdate:modelValue":s[20]||(s[20]=e=>M.value=e),defaults:D},null,8,["modelValue","defaults"])):p("",!0),K.value?(a(),k(Me,{key:4,modelValue:K.value,"onUpdate:modelValue":s[21]||(s[21]=e=>K.value=e),note:ye.value,doctype:"CRM Lead",doc:H.value},null,8,["modelValue","note","doc"])):p("",!0),J.value?(a(),k(Je,{key:5,modelValue:J.value,"onUpdate:modelValue":s[22]||(s[22]=e=>J.value=e),task:be.value,doctype:"CRM Lead",doc:H.value},null,8,["modelValue","task","doc"])):p("",!0)],64)}}};export{Cs as default};
//# sourceMappingURL=Leads-70c61764.js.map
