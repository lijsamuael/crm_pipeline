import{f as ce}from"./DeleteLinkedDocModal-4b9cf4d1.js";import{_ as me}from"./ErrorPage-9cbb8f6d.js";import{_ as de}from"./Resizer-e9d1cd58.js";import{_ as ue}from"./Icon-633b7081.js";import{g as _e,S as pe}from"./view-e31a1491.js";import{L as fe}from"./LayoutHeader-7c33b338.js";import{P as ge}from"./PhoneIcon-72f273eb.js";import{C as ye}from"./CameraIcon-34657371.js";import{D as ve}from"./DealsIcon-da3250d2.js";import{_ as be}from"./DealsListView-f7f67e00.js";import{u as he,b as j,f as we,t as Ce,a as O,D as ke,h as xe}from"./index-d994a7bf.js";import{u as De,s as ze,a as Se,_ as Me}from"./modals-be96e924.js";import{g as Ie}from"./settings-dedfba01.js";import{g as $e}from"./global-a06e427d.js";import{o as Ve}from"./organizations-6f5adc9e.js";import{s as Be}from"./statuses-4568588f.js";import{c as U}from"./DragVerticalIcon-79b45f6b.js";import{$ as Pe,l as z,y,a2 as Re,X as H,aQ as S,aR as C,c as v,u as o,g as d,w as _,B as m,b as u,F as Te,e as I,f as l,d as i,a6 as $,K as qe,t as b,aB as K,n as Q}from"./index-c721fff4.js";import{_ as Fe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-1770af36.js";import{F as Le}from"./FileUploader-04d14a6d.js";import{u as Ne}from"./pageMeta-3c354110.js";import"./EditIcon-1aa84c18.js";import"./Link-65fe6c07.js";import"./FadedScrollableDiv-c912e49a.js";import"./ArrowUpRightIcon-3e302d9f.js";import"./ListBulkActions-91692dd5.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-5c4d1748.js";import"./MultipleAvatar-0b6bd31f.js";import"./IndicatorIcon-41e40190.js";import"./ListFooter-800a631c.js";import"./TabButtons-eda90267.js";import"./description-000c0f16.js";const Ae={key:1,ref:"parentRef",class:"flex h-full"},Ee={class:"border-b"},je={class:"flex flex-col items-start justify-start gap-4 p-5"},Oe={class:"flex gap-4 items-center"},Ue={class:"group relative h-15.5 w-15.5"},He={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},Ke={class:"flex flex-col gap-2 truncate text-ink-gray-9"},Qe={class:"truncate text-2xl font-medium"},Xe={key:0},Ge={key:0,class:"flex items-center gap-1.5 text-base text-ink-gray-8"},Je={class:""},We={class:"flex gap-1.5"},Ye={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},Ze={key:1,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},ea={class:"flex flex-col items-center justify-center space-y-3"},Pa={__name:"Contact",props:{contactId:{type:String,required:!0}},setup(X){const{brand:G}=Ie(),{makeCall:J}=$e(),{getUser:V}=he(),{getOrganization:B}=Ve(),{getDealStatus:W}=Be(),{doctypeMeta:Y}=j("Contact"),h=X,f=Pe(),P=z(""),Z=z(""),{document:a}=De("Contact",h.contactId),ee=y(()=>{let e=[{label:__("Contacts"),route:{name:"Contacts"}}];if(f.query.view||f.query.viewType){let n=_e(f.query.view,f.query.viewType,"Contact");n&&e.push({label:__(n.label),icon:n.icon,route:{name:"Contacts",params:{viewType:f.query.viewType},query:{view:f.query.view}}})}return e.push({label:R.value,route:{name:"Contact",params:{contactId:h.contactId}}}),e}),R=y(()=>{var n,s;let e=((n=Y.Contact)==null?void 0:n.title_field)||"name";return((s=a.doc)==null?void 0:s[e])||h.contactId});Ne(()=>({title:R.value,icon:G.favicon}));const k=z(!1);async function ae(){k.value=!0}function T(e){a.doc.image=(e==null?void 0:e.file_url)||"",a.save.submit(null,{onSuccess:()=>{C.success(__("Contact image updated"))}})}const q=z(0),te=[{label:"Deals",icon:Re(ve,{class:"h-4 w-4"}),count:y(()=>{var e;return(e=x.data)==null?void 0:e.length})}],x=H({url:"crm.api.contact.get_linked_deals",cache:["deals",h.contactId],params:{contact:h.contactId},auto:!0}),M=y(()=>!x.data||x.data==[]?[]:x.data.map(e=>le(e))),D=H({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","Contact"],params:{doctype:"Contact"},auto:!0}),oe=y(()=>D.data?D.data.map(e=>({...e,columns:e.columns.map(n=>({...n,fields:n.fields.map(s=>{var p,w;return s.fieldname==="email_id"?{...s,read_only:!1,fieldtype:"Dropdown",options:(((p=a.doc)==null?void 0:p.email_ids)||[]).map(r=>({name:r.name,value:r.email_id,selected:r.email_id===a.doc.email_id,placeholder:"john@doe.com",onClick:()=>F("email",r.email_id),onSave:(t,c)=>c?L("email",t.value):N("Contact Email",t.name,"email_id",t.value),onDelete:async(t,c)=>{a.doc.email_ids=a.doc.email_ids.filter(g=>g.name!==t.name),c||await A("Contact Email",t.name)}})),create:()=>{a.doc.email_ids=[...a.doc.email_ids||[],{name:"new-1",value:"",selected:!1,isNew:!0}]}}:s.fieldname==="mobile_no"?{...s,read_only:!1,fieldtype:"Dropdown",options:(((w=a.doc)==null?void 0:w.phone_nos)||[]).map(r=>({name:r.name,value:r.phone,selected:r.phone===a.doc.mobile_no,onClick:()=>F("mobile_no",r.phone),onSave:(t,c)=>c?L("phone",t.value):N("Contact Phone",t.name,"phone",t.value),onDelete:async(t,c)=>{a.doc.phone_nos=a.doc.phone_nos.filter(g=>g.name!==t.name),c||await A("Contact Phone",t.name)}})),create:()=>{a.doc.phone_nos=[...a.doc.phone_nos||[],{name:"new-1",value:"",selected:!1,isNew:!0}]}}:s.fieldname==="address"?{...s,create:(r,t)=>{E(),t&&t()},edit:r=>E(r)}:s})}))})):[]);async function F(e,n){await S("crm.api.contact.set_as_primary",{contact:a.doc.name,field:e,value:n})&&(a.reload(),C.success(__("Contact updated")))}async function L(e,n){if(!n)return;await S("crm.api.contact.create_new",{contact:a.doc.name,field:e,value:n})&&(a.reload(),C.success(__("Contact updated")))}async function N(e,n,s,p){await S("frappe.client.set_value",{doctype:e,name:n,fieldname:s,value:p})&&(a.reload(),C.success(__("Contact updated")))}async function A(e,n){await S("frappe.client.delete",{doctype:e,name:n}),await a.reload(),C.success(__("Contact updated"))}const{getFormattedCurrency:ne}=j("CRM Deal"),se=y(()=>re);function le(e){var n,s;return{name:e.name,organization:{label:e.organization,logo:(n=B(e.organization))==null?void 0:n.organization_logo},annual_revenue:ne("annual_revenue",e),status:{label:e.status,color:(s=W(e.status))==null?void 0:s.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&V(e.deal_owner).full_name,...e.deal_owner&&V(e.deal_owner)},modified:{label:we(e.modified),timeAgo:__(Ce(e.modified))}}}const re=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];function E(e){ze.value=!0,Se.value={doctype:"Address",address:e}}return(e,n)=>{const s=I("ErrorMessage"),p=I("Button"),w=I("Badge"),r=ce;return l(),v(Te,null,[o(a).doc?(l(),d(fe,{key:0},{"left-header":_(()=>[u(o(Fe),{items:ee.value},{prefix:_(({item:t})=>[t.icon?(l(),d(ue,{key:0,icon:t.icon,class:"mr-2 h-4"},null,8,["icon"])):m("",!0)]),_:1},8,["items"])]),_:1})):m("",!0),o(a).doc?(l(),v("div",Ae,[o(a).doc?(l(),d(de,{key:0,parent:e.$refs.parentRef,class:"flex h-full flex-col overflow-hidden border-r"},{default:_(()=>[i("div",Ee,[u(o(Le),{onSuccess:T,validateFile:o(xe)},{default:_(({openFileSelector:t,error:c})=>{var g;return[i("div",je,[i("div",Oe,[i("div",Ue,[u(o(O),{size:"3xl",class:"h-15.5 w-15.5",label:o(a).doc.full_name,image:o(a).doc.image},null,8,["label","image"]),(l(),d($(o(a).doc.image?o(ke):"div"),qe(o(a).doc.image?{options:[{icon:"upload",label:o(a).doc.image?e.__("Change image"):e.__("Upload image"),onClick:t},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>T("")}]}:{onClick:t},{class:"!absolute bottom-0 left-0 right-0"}),{default:_(()=>[i("div",He,[u(ye,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:1},16))]),i("div",Ke,[i("div",Qe,[o(a).doc.salutation?(l(),v("span",Xe,b(o(a).doc.salutation+". "),1)):m("",!0),i("span",null,b(o(a).doc.full_name),1)]),o(a).doc.company_name?(l(),v("div",Ge,[u(o(O),{size:"xs",label:o(a).doc.company_name,image:(g=o(B)(o(a).doc.company_name))==null?void 0:g.organization_logo},null,8,["label","image"]),i("span",Je,b(o(a).doc.company_name),1)])):m("",!0),u(s,{message:e.__(c)},null,8,["message"])])]),i("div",We,[o(U)&&o(a).doc.mobile_no?(l(),d(p,{key:0,label:e.__("Make Call"),size:"sm",iconLeft:ge,onClick:n[0]||(n[0]=ie=>o(U)&&o(J)(o(a).doc.mobile_no))},null,8,["label"])):m("",!0),u(p,{label:e.__("Delete"),theme:"red",size:"sm",iconLeft:"trash-2",onClick:n[1]||(n[1]=ie=>ae())},null,8,["label"])])])]}),_:1},8,["validateFile"])]),o(D).data?(l(),v("div",Ye,[u(pe,{sections:oe.value,doctype:"Contact",docname:o(a).doc.name,onReload:o(D).reload},null,8,["sections","docname","onReload"])])):m("",!0)]),_:1},8,["parent"])):m("",!0),u(o(Me),{as:"div",modelValue:q.value,"onUpdate:modelValue":n[2]||(n[2]=t=>q.value=t),tabs:te},{"tab-item":_(({tab:t,selected:c})=>[i("button",{class:Q(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:border-outline-gray-3 hover:text-ink-gray-9",{"text-ink-gray-9":c}])},[t.icon?(l(),d($(t.icon),{key:0,class:"h-5"})):m("",!0),K(" "+b(e.__(t.label))+" ",1),u(w,{class:Q(["group-hover:bg-surface-gray-7",[c?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:_(()=>[K(b(t.count),1)]),_:2},1032,["class"])],2)]),"tab-panel":_(({tab:t})=>[t.label==="Deals"&&M.value.length?(l(),d(be,{key:0,class:"mt-4",rows:M.value,columns:se.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):m("",!0),M.value.length?m("",!0):(l(),v("div",Ze,[i("div",ea,[(l(),d($(t.icon),{class:"!h-10 !w-10"})),i("div",null,b(e.__("No {0} Found",[e.__(t.label)])),1)])]))]),_:1},8,["modelValue"])],512)):P.value?(l(),d(me,{key:2,errorTitle:P.value,errorMessage:Z.value},null,8,["errorTitle","errorMessage"])):m("",!0),k.value?(l(),d(r,{key:3,modelValue:k.value,"onUpdate:modelValue":n[3]||(n[3]=t=>k.value=t),doctype:"Contact",docname:o(a).doc.name,name:"Contacts"},null,8,["modelValue","docname"])):m("",!0)],64)}}};export{Pa as default};
//# sourceMappingURL=Contact-022198c3.js.map
