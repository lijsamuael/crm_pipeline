import{_ as I,$ as N,aK as R,l as r,y as H,a as T,aD as A,c as n,d as t,u as q,t as o,n as m,F as h,r as b,B as w,aU as Q,aQ as v,aR as x,f as i}from"./index-c721fff4.js";const K={class:"min-h-screen bg-gray-50"},W={class:"sticky top-0 z-10 bg-white border-b border-gray-200"},G={class:"px-6 py-4"},J={class:"flex items-center justify-between"},X={class:"flex items-center space-x-4"},Y={class:"text-2xl font-semibold text-gray-900"},Z={class:"flex items-center space-x-4 mt-1"},tt={class:"text-sm text-gray-500"},et={class:"flex items-center space-x-3"},st={key:0,class:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20"},at=["onClick","disabled"],ot={key:0,class:"text-blue-600 text-xs"},lt=["disabled"],nt={key:0},it={key:1},rt={class:"max-w-7xl mx-auto px-6 py-6"},dt={class:"grid grid-cols-3 gap-6"},ut={class:"col-span-2 space-y-6"},ct={class:"bg-white rounded-lg border border-gray-200 shadow-sm"},mt={class:"p-6"},xt={class:"flex items-center justify-between mb-4"},gt={class:"grid grid-cols-3 gap-4"},pt={class:"text-center p-4 bg-gray-50 rounded-lg"},vt={class:"text-2xl font-bold text-gray-900"},yt={class:"text-center p-4 bg-gray-50 rounded-lg"},ft={class:"text-2xl font-bold text-gray-900"},_t={class:"text-center p-4 bg-gray-50 rounded-lg"},ht={class:"text-2xl font-bold text-gray-900"},bt={class:"bg-white rounded-lg border border-gray-200 shadow-sm"},wt={class:"p-6"},kt={class:"flex items-center justify-between mb-6"},Ct={class:"text-sm text-gray-500"},Dt={key:0,class:"space-y-4"},St={class:"flex items-center justify-between mb-3"},jt={class:"flex items-center space-x-3"},Pt={class:"font-medium text-gray-900"},Ft={class:"text-sm text-gray-500"},Lt={class:"text-right"},Et={class:"font-semibold text-gray-900"},Ot={class:"text-sm text-gray-500"},zt={class:"grid grid-cols-3 gap-4 text-sm"},Bt={class:"font-medium text-gray-900"},Mt={class:"font-medium text-gray-900"},Ut={class:"font-medium text-gray-900"},Vt={key:1,class:"text-center py-8"},$t={class:"bg-white rounded-lg border border-gray-200 shadow-sm"},It={class:"p-6"},Nt={class:"flex items-center justify-between mb-6"},Rt=["disabled"],Ht={key:0,class:"overflow-hidden"},Tt={class:"min-w-full divide-y divide-gray-200"},At={class:"bg-white divide-y divide-gray-200"},qt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Qt={class:"px-6 py-4 whitespace-nowrap"},Kt={class:"px-6 py-4 whitespace-nowrap"},Wt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Gt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Jt={class:"flex items-center space-x-2"},Xt={class:"w-6 h-6 bg-purple-500 rounded-full flex items-center justify-center text-xs text-white font-medium"},Yt={key:1,class:"text-center py-8"},Zt={class:"space-y-6"},te={class:"bg-white rounded-lg border border-gray-200 shadow-sm"},ee={class:"p-6"},se={class:"space-y-4"},ae={class:"flex items-center space-x-2 mt-1"},oe={class:"w-6 h-6 bg-purple-500 rounded-full flex items-center justify-center text-xs text-white font-medium"},le={class:"text-sm text-gray-900"},ne={class:"text-sm text-gray-900 mt-1"},ie={class:"text-sm text-gray-900 mt-1"},re={class:"text-sm text-gray-900 mt-1"},de={class:"text-sm text-gray-900 mt-1"},ue={class:"text-sm text-gray-900 mt-1"},ce={class:"bg-white rounded-lg border border-gray-200 shadow-sm"},me={class:"p-6"},xe={class:"space-y-4"},ge={class:"text-sm text-gray-900 mt-1"},pe={class:"text-sm text-gray-900 mt-1"},ve=["href"],ye={class:"text-sm text-gray-900 mt-1"},fe={class:"text-sm text-gray-900 mt-1"},_e={key:0,class:"bg-white rounded-lg border border-gray-200 shadow-sm"},he={class:"p-6"},be={class:"space-y-4"},we={class:"text-sm text-gray-900 mt-1"},ke={class:"text-sm text-gray-900 mt-1"},Ce={__name:"Pipeline",setup(De){const L=N(),E=R(),s=r({}),y=r([]),f=r(!1),g=r(!1),d=r(!1),k=r(!1),_=r(null);async function O(){try{const a=await v("frappe.client.get_list",{doctype:"CRM Pipeline Status",fields:["name"],order_by:"creation asc"});y.value=a.map(e=>e.name)}catch(a){console.error("Error fetching pipeline statuses:",a),y.value=["Draft","Active","In Progress","On Hold","Completed","Lost","Cancelled","Open"]}}async function p(){f.value=!0;try{const a=await v("frappe.client.get",{doctype:"CRM Pipeline",name:L.params.pipelineId});s.value=a}catch(a){console.error("Error fetching pipeline:",a),x.error("Failed to load pipeline details")}finally{f.value=!1}}function z(){d.value=!d.value}async function B(a){if(a===s.value.status){d.value=!1;return}k.value=!0;try{await v("crm_pipeline.api.update_pipeline_status",{pipeline_name:s.value.name,new_status:a}),x.success(`Pipeline status changed to ${a}`),d.value=!1,await p()}catch(e){console.error("Error changing pipeline status:",e),x.error("Failed to change pipeline status")}finally{k.value=!1}}async function C(){g.value=!0;try{await v("crm_pipeline.api.create_deal_from_pipeline",{pipeline_name:s.value.name}),x.success("Pipeline converted to deal successfully"),await p()}catch(a){console.error("Error converting pipeline:",a),x.error("Failed to convert pipeline to deal")}finally{g.value=!1}}function M(){return!s.value.deals||!s.value.deals.length?0:s.value.deals.reduce((a,e)=>a+(e.deal_value||0),0)}const U=H(()=>s.value.logs?[...s.value.logs].sort((a,e)=>new Date(e.from_date)-new Date(a.from_date)):[]);function V(a){if(!a||a==="0.000000000")return"—";const e=parseFloat(a);return e<60?`${e.toFixed(1)}s`:e<3600?`${(e/60).toFixed(1)}m`:e<86400?`${(e/3600).toFixed(1)}h`:`${(e/86400).toFixed(1)}d`}function D(a){_.value&&!_.value.contains(a.target)&&(d.value=!1)}function S(a){return a?a.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"—"}function u(a){return{Active:"bg-green-100 text-green-800","In Progress":"bg-blue-100 text-blue-800",Completed:"bg-purple-100 text-purple-800",Lost:"bg-red-100 text-red-800",Draft:"bg-gray-100 text-gray-800","On Hold":"bg-yellow-100 text-yellow-800",Cancelled:"bg-gray-100 text-gray-800",Open:"bg-blue-100 text-blue-800"}[a]||"bg-gray-100 text-gray-800"}function c(a){if(!a)return"$0";const e=typeof a=="string"?parseFloat(a):a;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function j(a){return a?new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"—"}function $(a){return a?new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}return T(()=>{O(),p(),document.addEventListener("click",D)}),A(()=>{document.removeEventListener("click",D)}),(a,e)=>{var P,F;return i(),n("div",K,[t("div",W,[t("div",G,[t("div",J,[t("div",X,[t("button",{onClick:e[0]||(e[0]=l=>q(E).back()),class:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"},[...e[1]||(e[1]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),t("div",null,[t("h1",Y,o(s.value.pipeline_name||s.value.name),1),t("div",Z,[e[2]||(e[2]=t("span",{class:"text-sm text-gray-500"},"Pipeline",-1)),e[3]||(e[3]=t("span",{class:"text-sm text-gray-500"},"•",-1)),t("span",tt,o(s.value.name),1)])])]),t("div",et,[t("div",{class:"relative",ref_key:"statusDropdown",ref:_},[t("button",{onClick:z,class:"flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors text-sm font-medium"},[t("span",{class:m([u(s.value.status),"px-2 py-1 rounded-full text-xs font-medium"])},o(s.value.status),3),e[4]||(e[4]=t("svg",{class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),d.value?(i(),n("div",st,[(i(!0),n(h,null,b(y.value,l=>(i(),n("button",{key:l,onClick:Se=>B(l),disabled:l===s.value.status,class:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed"},[t("span",{class:m([u(l),"px-2 py-1 rounded-full text-xs font-medium"])},o(l),3),l===s.value.status?(i(),n("span",ot,"Current")):w("",!0)],8,at))),128))])):w("",!0)],512),t("button",{onClick:C,disabled:g.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed"},[g.value?(i(),n("span",nt,"Converting...")):(i(),n("span",it,"Convert to Deal"))],8,lt)])])])]),t("div",rt,[t("div",dt,[t("div",ut,[t("div",ct,[t("div",mt,[t("div",xt,[e[5]||(e[5]=t("h3",{class:"text-lg font-medium text-gray-900"},"Pipeline Status",-1)),t("span",{class:m([u(s.value.status),"px-3 py-1 rounded-full text-sm font-medium"])},o(s.value.status),3)]),t("div",gt,[t("div",pt,[t("div",vt,o(c(s.value.est_pipeline_value)),1),e[6]||(e[6]=t("div",{class:"text-sm text-gray-500 mt-1"},"Estimated Value",-1))]),t("div",yt,[t("div",ft,o(((P=s.value.deals)==null?void 0:P.length)||0),1),e[7]||(e[7]=t("div",{class:"text-sm text-gray-500 mt-1"},"Total Deals",-1))]),t("div",_t,[t("div",ht,o(c(M())),1),e[8]||(e[8]=t("div",{class:"text-sm text-gray-500 mt-1"},"Actual Value",-1))])])])]),t("div",bt,[t("div",wt,[t("div",kt,[e[9]||(e[9]=t("h3",{class:"text-lg font-medium text-gray-900"},"Deals",-1)),t("div",Ct,o(((F=s.value.deals)==null?void 0:F.length)||0)+" deals",1)]),s.value.deals&&s.value.deals.length?(i(),n("div",Dt,[(i(!0),n(h,null,b(s.value.deals,l=>(i(),n("div",{key:l.deal,class:"border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors"},[t("div",St,[t("div",jt,[e[10]||(e[10]=t("div",{class:"w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center text-white font-medium text-sm"}," D ",-1)),t("div",null,[t("div",Pt,o(l.deal),1),t("div",Ft,"Probability: "+o(l.probablity)+"%",1)])]),t("div",Lt,[t("div",Et,o(c(l.est_qoutation_sales)),1),t("div",Ot,"Expected: "+o(l.expected_deal_value)+"%",1)])]),t("div",zt,[t("div",null,[e[11]||(e[11]=t("div",{class:"text-gray-500"},"Deal Value",-1)),t("div",Bt,o(c(l.deal_value)),1)]),t("div",null,[e[12]||(e[12]=t("div",{class:"text-gray-500"},"Quotation Sales",-1)),t("div",Mt,o(c(l.est_qoutation_sales)),1)]),t("div",null,[e[13]||(e[13]=t("div",{class:"text-gray-500"},"Owner",-1)),t("div",Ut,o(l.deal_owner||"Unassigned"),1)])])]))),128))])):(i(),n("div",Vt,[e[14]||(e[14]=Q('<div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4" data-v-fc7d09ca><svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-fc7d09ca><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" data-v-fc7d09ca></path></svg></div><h3 class="text-lg font-medium text-gray-900 mb-2" data-v-fc7d09ca>No deals yet</h3><p class="text-gray-500 text-sm mb-4" data-v-fc7d09ca>Convert this pipeline to create deals</p>',3)),t("button",{onClick:C,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium"}," Convert to Deal ")]))])]),t("div",$t,[t("div",It,[t("div",Nt,[e[16]||(e[16]=t("h3",{class:"text-lg font-medium text-gray-900"},"Status Change History",-1)),t("button",{onClick:p,disabled:f.value,class:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Refresh logs"},[...e[15]||(e[15]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])],8,Rt)]),s.value.logs&&s.value.logs.length?(i(),n("div",Ht,[t("table",Tt,[e[17]||(e[17]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Change Date "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," From Status "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," To Status "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Duration "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Log Owner ")])],-1)),t("tbody",At,[(i(!0),n(h,null,b(U.value,l=>(i(),n("tr",{key:l.name,class:"hover:bg-gray-50 transition-colors"},[t("td",qt,o($(l.from_date)),1),t("td",Qt,[t("span",{class:m([u(l.from_status),"px-2 py-1 rounded-full text-xs font-medium"])},o(l.from_status||"—"),3)]),t("td",Kt,[t("span",{class:m([u(l.to_status),"px-2 py-1 rounded-full text-xs font-medium"])},o(l.to_status||"—"),3)]),t("td",Wt,o(V(l.duration)),1),t("td",Gt,[t("div",Jt,[t("div",Xt,o(S(l.log_owner)),1),t("span",null,o(l.log_owner||"System"),1)])])]))),128))])])])):(i(),n("div",Yt,[...e[18]||(e[18]=[t("div",{class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"},[t("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1),t("p",{class:"text-gray-500 text-sm"},"No status change history available",-1)])]))])])]),t("div",Zt,[t("div",te,[t("div",ee,[e[25]||(e[25]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Pipeline Information",-1)),t("div",se,[t("div",null,[e[19]||(e[19]=t("label",{class:"text-sm font-medium text-gray-500"},"Pipeline Owner",-1)),t("div",ae,[t("div",oe,o(S(s.value.pipeline_owner)),1),t("span",le,o(s.value.pipeline_owner),1)])]),t("div",null,[e[20]||(e[20]=t("label",{class:"text-sm font-medium text-gray-500"},"Source",-1)),t("div",ne,o(s.value.source||"—"),1)]),t("div",null,[e[21]||(e[21]=t("label",{class:"text-sm font-medium text-gray-500"},"Created",-1)),t("div",ie,o(j(s.value.creation)),1)]),t("div",null,[e[22]||(e[22]=t("label",{class:"text-sm font-medium text-gray-500"},"Last Modified",-1)),t("div",re,o(j(s.value.modified)),1)]),t("div",null,[e[23]||(e[23]=t("label",{class:"text-sm font-medium text-gray-500"},"Currency",-1)),t("div",de,o(s.value.currency||"USD"),1)]),t("div",null,[e[24]||(e[24]=t("label",{class:"text-sm font-medium text-gray-500"},"Exchange Rate",-1)),t("div",ue,o(s.value.exchange_rate||"1.0"),1)])])])]),t("div",ce,[t("div",me,[e[30]||(e[30]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Organization",-1)),t("div",xe,[t("div",null,[e[26]||(e[26]=t("label",{class:"text-sm font-medium text-gray-500"},"Organization Name",-1)),t("div",ge,o(s.value.organization_name||s.value.organization),1)]),t("div",null,[e[27]||(e[27]=t("label",{class:"text-sm font-medium text-gray-500"},"Website",-1)),t("div",pe,[t("a",{href:s.value.website,target:"_blank",class:"text-blue-600 hover:text-blue-700"},o(s.value.website||"—"),9,ve)])]),t("div",null,[e[28]||(e[28]=t("label",{class:"text-sm font-medium text-gray-500"},"Employees",-1)),t("div",ye,o(s.value.no_of_employees||"0"),1)]),t("div",null,[e[29]||(e[29]=t("label",{class:"text-sm font-medium text-gray-500"},"Territory",-1)),t("div",fe,o(s.value.territory||"—"),1)])])])]),s.value.lead?(i(),n("div",_e,[t("div",he,[e[33]||(e[33]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Lead Information",-1)),t("div",be,[t("div",null,[e[31]||(e[31]=t("label",{class:"text-sm font-medium text-gray-500"},"Lead",-1)),t("div",we,o(s.value.lead),1)]),t("div",null,[e[32]||(e[32]=t("label",{class:"text-sm font-medium text-gray-500"},"Lead Name",-1)),t("div",ke,o(s.value.lead_name),1)])])])])):w("",!0)])])])])}}},Pe=I(Ce,[["__scopeId","data-v-fc7d09ca"]]);export{Pe as default};
//# sourceMappingURL=Pipeline-64142e1f.js.map
