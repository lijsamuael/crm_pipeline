{"version":3,"file":"statuses-dc79e6cb.js","sources":["../../../../frontend/src/stores/statuses.js"],"sourcesContent":["import IndicatorIcon from '@/components/Icons/IndicatorIcon.vue'\nimport { capture } from '@/telemetry'\nimport { parseColor } from '@/utils'\nimport { defineStore } from 'pinia'\nimport { createListResource } from 'frappe-ui'\nimport { reactive, h } from 'vue'\n\nexport const statusesStore = defineStore('crm-statuses', () => {\n  let leadStatusesByName = reactive({})\n  let dealStatusesByName = reactive({})\n  let pipelineStatusesByName = reactive({})\n  let communicationStatusesByName = reactive({})\n\n  const leadStatuses = createListResource({\n    doctype: 'CRM Lead Status',\n    fields: ['name', 'color', 'position'],\n    orderBy: 'position asc',\n    cache: 'lead-statuses',\n    initialData: [],\n    auto: true,\n    transform(statuses) {\n      for (let status of statuses) {\n        status.color = parseColor(status.color)\n        leadStatusesByName[status.name] = status\n      }\n      return statuses\n    },\n  })\n\n  const dealStatuses = createListResource({\n    doctype: 'CRM Deal Status',\n    fields: ['name', 'color', 'position', 'type'],\n    orderBy: 'position asc',\n    cache: 'deal-statuses',\n    initialData: [],\n    auto: true,\n    transform(statuses) {\n      for (let status of statuses) {\n        status.color = parseColor(status.color)\n        dealStatusesByName[status.name] = status\n      }\n      return statuses\n    },\n  })\n\n  const pipelineStatuses = createListResource({\n    doctype: 'CRM Pipeline Status',\n    fields: ['name', 'color', 'position'],\n    orderBy: 'position asc',\n    cache: 'pipeline-statuses',\n    initialData: [],\n    auto: true,\n    transform(statuses) {\n      for (let status of statuses) {\n        status.color = parseColor(status.color)\n        pipelineStatusesByName[status.name] = status\n      }\n      return statuses\n    },\n  })\n\n  const communicationStatuses = createListResource({\n    doctype: 'CRM Communication Status',\n    fields: ['name'],\n    cache: 'communication-statuses',\n    initialData: [],\n    auto: true,\n    transform(statuses) {\n      for (let status of statuses) {\n        communicationStatusesByName[status.name] = status\n      }\n      return statuses\n    },\n  })\n\n  function getLeadStatus(name) {\n    if (!name) {\n      name = leadStatuses.data[0].name\n    }\n    return leadStatusesByName[name]\n  }\n\n  function getDealStatus(name) {\n    if (!name) {\n      name = dealStatuses.data[0].name\n    }\n    return dealStatusesByName[name]\n  }\n\n  function getPipelineStatus(name) {\n    if (!name) {\n      name = pipelineStatuses.data[0]?.name\n    }\n    return pipelineStatusesByName[name] || { name: name, color: 'gray' }\n  }\n\n  function getCommunicationStatus(name) {\n    if (!name) {\n      name = communicationStatuses.data[0].name\n    }\n    return communicationStatuses[name]\n  }\n\n  function statusOptions(doctype, statuses = [], triggerStatusChange = null) {\n    let statusesByName = {}\n    \n    if (doctype == 'deal') {\n      statusesByName = dealStatusesByName\n    } else if (doctype == 'pipeline') {\n      statusesByName = pipelineStatusesByName\n    } else {\n      statusesByName = leadStatusesByName\n    }\n\n    if (statuses?.length) {\n      statusesByName = statuses.reduce((acc, status) => {\n        acc[status] = statusesByName[status]\n        return acc\n      }, {})\n    }\n\n    let options = []\n    for (const status in statusesByName) {\n      options.push({\n        label: statusesByName[status]?.name,\n        value: statusesByName[status]?.name,\n        icon: () => h(IndicatorIcon, { class: statusesByName[status]?.color }),\n        onClick: async () => {\n          await triggerStatusChange?.(statusesByName[status]?.name)\n          capture('status_changed', { doctype, status })\n        },\n      })\n    }\n    return options\n  }\n\n  return {\n    leadStatuses,\n    dealStatuses,\n    pipelineStatuses,\n    communicationStatuses,\n    getLeadStatus,\n    getDealStatus,\n    getPipelineStatus,\n    getCommunicationStatus,\n    statusOptions,\n  }\n})"],"names":["statusesStore","defineStore","leadStatusesByName","reactive","dealStatusesByName","pipelineStatusesByName","communicationStatusesByName","leadStatuses","createListResource","statuses","status","parseColor","dealStatuses","pipelineStatuses","communicationStatuses","getLeadStatus","name","getDealStatus","getPipelineStatus","_a","getCommunicationStatus","statusOptions","doctype","triggerStatusChange","statusesByName","acc","options","_b","h","IndicatorIcon","capture"],"mappings":"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"}