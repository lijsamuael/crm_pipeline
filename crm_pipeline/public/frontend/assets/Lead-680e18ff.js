import{f as _e}from"./DeleteLinkedDocModal-25cd8320.js";import{_ as ge}from"./ErrorPage-4ed70f27.js";import{_ as ye}from"./Icon-5431cc70.js";import{_ as be}from"./Resizer-62aeb522.js";import{A as he,a as te,u as Ce,_ as ke,b as we,c as xe,S as Me}from"./useActiveTabManager-83417dc9.js";import{E as Ie}from"./Email2Icon-2ec32944.js";import{C as Ve}from"./CommentIcon-2282205d.js";import{D as Le}from"./DetailsIcon-848d2598.js";import{P as Ee}from"./PhoneIcon-70b3a745.js";import{T as Re}from"./TaskIcon-78f92ad5.js";import{N as $e}from"./NoteModal-848b61de.js";import{W as Se}from"./WhatsAppIcon-9502b55f.js";import{I as Ae}from"./IndicatorIcon-466bb833.js";import{C as De}from"./CameraIcon-c81b15bb.js";import{L as Te}from"./LinkIcon-754397ed.js";import{L as ze}from"./LayoutHeader-027ebcdc.js";import{g as qe,S as Fe}from"./view-f73d32b6.js";import{_ as oe}from"./CustomActions-d3cf25f1.js";import{O as Oe}from"./OrganizationsIcon-6ee34b4d.js";import{C as Pe}from"./ContactsIcon-ef708308.js";import{E as Ue}from"./EditIcon-d7d50f24.js";import{F as Ne}from"./FieldLayout-9e608d31.js";import{L as le}from"./Link-3cfde2ee.js";import{u as Z,c as Be,q as je,_ as We}from"./modals-e23741cc.js";import{u as Qe,e as se,b as Ge,s as Ke,D as ne,i as He,h as Xe,a as Ye,o as Je}from"./index-2d68a6a0.js";import{N as Ze,O as ea,aK as ue,a0 as aa,l as b,y as z,X as de,e as N,f as u,g as c,w as _,d as r,t as L,u as o,B as f,b as n,c as q,W as ta,aQ as ee,aT as oa,$ as la,z as ie,aS as sa,aI as re,F as na,aR as S,n as ia,K as ra,a6 as ua,Y as da,G as ca}from"./index-a094f868.js";import{s as ce}from"./statuses-dc79e6cb.js";import{i as ma,w as pa,c as va}from"./DragVerticalIcon-12e66a71.js";import{u as fa}from"./helpCenter-6244f2ec.js";import{g as _a}from"./settings-6524f74f.js";import{g as ga}from"./global-c1d3e1d5.js";import{_ as ya}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-f91d31a9.js";import{F as ba}from"./FileUploader-02f346d7.js";import{u as ha}from"./pageMeta-ccf84976.js";import"./CalendarIcon-230645ec.js";import"./CallLogModal-447b1e6f.js";import"./ArrowUpRightIcon-9ddf39c9.js";import"./LeadsIcon-bb4322a7.js";import"./DealsIcon-4613d91f.js";import"./TaskModal-03afb2a1.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-e2f7307d.js";import"./FadedScrollableDiv-0eedb39b.js";import"./MultipleAvatar-d9f4a074.js";import"./event-c2e587ab.js";import"./ComboboxViewport-87bc0927.js";import"./IconPicker-1152affd.js";import"./EmailMultiSelect-8cbe0a34.js";const Ca={class:"mb-6 flex items-center justify-between"},ka={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},wa={class:"flex items-center gap-1"},xa={class:"mb-4 flex items-center gap-2 text-ink-gray-5"},Ma={class:"block text-base"},Ia={class:"ml-6 text-ink-gray-9"},Va={class:"flex items-center justify-between text-base"},La={key:1,class:"mt-2.5 text-base"},Ea={class:"mb-4 mt-6 flex items-center gap-2 text-ink-gray-5"},Ra={class:"block text-base"},$a={class:"ml-6 text-ink-gray-9"},Sa={class:"flex items-center justify-between text-base"},Aa={key:1,class:"mt-2.5 text-base"},Da={key:0,class:"h-px w-full border-t my-6"},Ta={class:"flex justify-end"},za={__name:"ConvertToDealModal",props:Ze({lead:{type:Object,required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(h){const F=h,E=ea(h,"modelValue"),B=ue(),{statusOptions:j,getDealStatus:W}=ce(),{isManager:Q}=Qe(),{user:G}=aa(),{updateOnboardingStep:R}=fa("frappecrm"),M=b(!1),C=b(!1),k=b(""),g=b(""),p=b(""),{triggerConvertToDeal:A}=Z("CRM Lead",F.lead.name),{document:y}=Z("CRM Deal");async function K(){if(p.value="",M.value&&!k.value){p.value=__("Please select an existing contact");return}if(C.value&&!g.value){p.value=__("Please select an existing organization");return}!M.value&&k.value&&(k.value=""),!C.value&&g.value&&(g.value=""),await(A==null?void 0:A(F.lead,y.doc,()=>E.value=!1));let i=await ee("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:F.lead.name,deal:y.doc,existing_contact:k.value,existing_organization:g.value}).catch(t=>{var w;if(t.exc_type=="MandatoryError"){const I=t.messages.map(l=>{let V=l.split(": ");return V[V.length-1].trim()}).join(", ");I.toLowerCase().includes("required")?p.value=__(I):p.value=__("{0} is required",[I]);return}p.value=__("Error converting to deal: {0}",[(w=t.messages)==null?void 0:w[0]])});i&&(E.value=!1,M.value=!1,C.value=!1,k.value="",g.value="",p.value="",R("convert_lead_to_deal",!0,!1,()=>{localStorage.setItem("firstDeal"+G,i)}),oa("convert_lead_to_deal"),B.push({name:"Deal",params:{dealId:i}}))}const O=z(()=>{var t;let i=j("deal");return(t=y.doc)!=null&&t.status||(y.doc.status=i[0].value),i}),$=de({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["RequiredFields","CRM Deal"],params:{doctype:"CRM Deal",type:"Required Fields"},auto:!0,transform:i=>{let t=!1,w=i==null?void 0:i.forEach(I=>{var l;(l=I.sections)==null||l.forEach(V=>{var m;(m=V.columns)==null||m.forEach(X=>{var D;(D=X.fields)==null||D.forEach(v=>{t=!0,v.fieldname=="status"&&(v.fieldtype="Select",v.options=O.value,v.prefix=W(y.doc.status).color),v.fieldtype==="Table"&&(y.doc[v.fieldname]=[])})})})});return t?w:[]}});function H(){Be.value=!0,je.value={doctype:"CRM Deal",onlyRequired:!0},E.value=!1}return(i,t)=>{const w=N("Button"),I=N("ErrorMessage");return u(),c(o(ta),{modelValue:E.value,"onUpdate:modelValue":t[5]||(t[5]=l=>E.value=l),options:{size:"xl"}},{"body-header":_(()=>[r("div",Ca,[r("div",null,[r("h3",ka,L(i.__("Convert to Deal")),1)]),r("div",wa,[o(Q)()&&!o(ma)?(u(),c(w,{key:0,variant:"ghost",tooltip:i.__("Edit deal's mandatory fields layout"),icon:Ue,onClick:H},null,8,["tooltip"])):f("",!0),n(w,{icon:"x",variant:"ghost",onClick:t[0]||(t[0]=l=>E.value=!1)})])])]),"body-content":_(()=>{var l,V;return[r("div",xa,[n(Oe,{class:"h-4 w-4"}),r("label",Ma,L(i.__("Organization")),1)]),r("div",Ia,[r("div",Va,[r("div",null,L(i.__("Choose Existing")),1),n(o(se),{modelValue:C.value,"onUpdate:modelValue":t[1]||(t[1]=m=>C.value=m)},null,8,["modelValue"])]),C.value?(u(),c(le,{key:0,class:"form-control mt-2.5",size:"md",value:g.value,doctype:"CRM Organization",onChange:t[2]||(t[2]=m=>g.value=m)},null,8,["value"])):(u(),q("div",La,L(i.__("New organization will be created based on the data in details section")),1))]),r("div",Ea,[n(Pe,{class:"h-4 w-4"}),r("label",Ra,L(i.__("Contact")),1)]),r("div",$a,[r("div",Sa,[r("div",null,L(i.__("Choose Existing")),1),n(o(se),{modelValue:M.value,"onUpdate:modelValue":t[3]||(t[3]=m=>M.value=m)},null,8,["modelValue"])]),M.value?(u(),c(le,{key:0,class:"form-control mt-2.5",size:"md",value:k.value,doctype:"Contact",onChange:t[4]||(t[4]=m=>k.value=m)},null,8,["value"])):(u(),q("div",Aa,L(i.__("New contact will be created based on the person's details")),1))]),(l=o($).data)!=null&&l.length?(u(),q("div",Da)):f("",!0),(V=o($).data)!=null&&V.length?(u(),c(Ne,{key:1,tabs:o($).data,data:o(y).doc,doctype:"CRM Deal"},null,8,["tabs","data"])):f("",!0),n(I,{class:"mt-4",message:p.value},null,8,["message"])]}),actions:_(()=>[r("div",Ta,[n(w,{label:i.__("Convert"),variant:"solid",onClick:K},null,8,["label"])])]),_:1},8,["modelValue"])}}},qa={key:0,class:"flex h-full overflow-hidden"},Fa={class:"flex items-center justify-start gap-5 border-b p-5"},Oa={class:"group relative size-12"},Pa={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},Ua={class:"flex flex-col gap-2.5 truncate"},Na={class:"truncate text-2xl font-medium text-ink-gray-9"},Ba={class:"flex gap-1.5"},ja={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},Ft={__name:"Lead",props:{leadId:{type:String,required:!0}},setup(h){const{brand:F}=_a(),{$dialog:E,$socket:B,makeCall:j}=ga(),{statusOptions:W,getLeadStatus:Q}=ce(),{doctypeMeta:G}=Ge("CRM Lead"),R=la(),M=ue(),C=h,k=b(!1),g=b(null),p=b(""),A=b(""),y=b(!1),K=()=>{ee("crm_pipeline.api.create_pipeline_from_lead",{lead_name:C.leadId}).then(e=>{S.success(__("Lead converted to Pipeline successfully")),M.push({name:"Pipeline"})}).catch(e=>{S.error(e.message||__("Failed to convert Lead to Pipeline"))})},O=b(!1),$=b(!1),{triggerOnChange:H,assignees:i,document:t,scripts:w,error:I}=Z("CRM Lead",C.leadId),l=z(()=>t.doc||{});ie(I,e=>{var a;e?(p.value=__(e.exc_type=="DoesNotExistError"?"Document not found":"Error occurred"),A.value=__(((a=e.messages)==null?void 0:a[0])||"An error occurred")):(p.value="",A.value="")}),ie(()=>t.doc,async e=>{var a;if((a=w.data)!=null&&a.length){let d=await Ke(w.data,{doc:e,$dialog:E,$socket:B,router:M,toast:S,updateField:U,createToast:S.create,deleteDoc:ae,call:ee});t._actions=d.actions||[],t._statuses=d.statuses||[]}},{once:!0});const V=z(()=>{let e=[{label:__("Leads"),route:{name:"Leads"}}];if(R.query.view||R.query.viewType){let a=qe(R.query.view,R.query.viewType,"CRM Lead");a&&e.push({label:__(a.label),icon:a.icon,route:{name:"Leads",params:{viewType:R.query.viewType},query:{view:R.query.view}}})}return e.push({label:m.value,route:{name:"Lead",params:{leadId:C.leadId}}}),e}),m=z(()=>{var a,d;let e=((a=G["CRM Lead"])==null?void 0:a.title_field)||"name";return((d=l.value)==null?void 0:d[e])||C.leadId}),X=z(()=>{var a;let e=(a=t.statuses)!=null&&a.length?t.statuses:t._statuses||[];return W("lead",e,pe)});ha(()=>({title:m.value,icon:F.favicon}));const D=z(()=>[{name:"Activity",label:__("Activity"),icon:he},{name:"Comments",label:__("Comments"),icon:Ve},{name:"Data",label:__("Data"),icon:Le},{name:"Tasks",label:__("Tasks"),icon:Re},{name:"Notes",label:__("Notes"),icon:$e},{name:"Attachments",label:__("Attachments"),icon:te},{name:"WhatsApp",label:__("WhatsApp"),icon:Se,condition:()=>pa.value}].filter(a=>a.condition?a.condition():!0)),{tabIndex:v,changeTabTo:me}=Ce(D,"lastLeadTab"),Y=de({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Lead"],params:{doctype:"CRM Lead"},auto:!0});async function pe(e){await H("status",e),t.save.submit()}function U(e,a){a=Array.isArray(e)?"":a;let d=Array.isArray(e)?{}:l.value[e];Array.isArray(e)?e.forEach(P=>l.value[P]=a):l.value[e]=a,t.save.submit(null,{onSuccess:()=>k.value=!0,onError:P=>{var s;Array.isArray(e)?e.forEach(x=>l.value[x]=d[x]):l.value[e]=d,S.error(((s=P.messages)==null?void 0:s[0])||__("Error updating field"))}})}function ae(){y.value=!0}function ve(){let e=D.value[v.value];["Emails","Comments","Activities"].includes(e.name)||g.value.changeTabTo("emails"),ca(()=>g.value.emailBox.show=!0)}function fe(e){t.save.submit(null,{onSuccess:()=>J(e)})}function J(e){e!=null&&e.hasOwnProperty("lead_owner")&&i.reload()}return(e,a)=>{const d=N("Button"),P=N("ErrorMessage");return u(),q(na,null,[n(ze,null,sa({"left-header":_(()=>[n(o(ya),{items:V.value},{prefix:_(({item:s})=>[s.icon?(u(),c(ye,{key:0,icon:s.icon,class:"mr-2 h-4"},null,8,["icon"])):f("",!0)]),_:1},8,["items"])]),_:2},[p.value?void 0:{name:"right-header",fn:_(()=>{var s,x;return[(s=o(t)._actions)!=null&&s.length?(u(),c(oe,{key:0,actions:o(t)._actions},null,8,["actions"])):f("",!0),(x=o(t).actions)!=null&&x.length?(u(),c(oe,{key:1,actions:o(t).actions},null,8,["actions"])):f("",!0),n(we,{modelValue:o(i).data,"onUpdate:modelValue":a[0]||(a[0]=T=>o(i).data=T),doctype:"CRM Lead",docname:h.leadId},null,8,["modelValue","docname"]),l.value&&o(t).statuses?(u(),c(o(ne),{key:2,options:X.value,placement:"right"},{default:_(({open:T})=>[l.value.status?(u(),c(d,{key:0,label:l.value.status,iconRight:T?"chevron-up":"chevron-down"},{prefix:_(()=>[n(Ae,{class:ia(o(Q)(l.value.status).color)},null,8,["class"])]),_:1},8,["label","iconRight"])):f("",!0)]),_:1},8,["options"])):f("",!0),n(d,{label:e.__("Convert to Lead"),variant:"solid",onClick:a[1]||(a[1]=T=>$.value=!0)},null,8,["label"]),n(d,{label:e.__("Convert to Pipeline"),variant:"solid",onClick:K},null,8,["label"])]}),key:"0"}]),1024),l.value.name?(u(),q("div",qa,[n(o(We),{as:"div",modelValue:o(v),"onUpdate:modelValue":a[4]||(a[4]=s=>re(v)?v.value=s:null),tabs:D.value},{"tab-panel":_(()=>[n(xe,{ref_key:"activities",ref:g,doctype:"CRM Lead",docname:h.leadId,tabs:D.value,reload:k.value,"onUpdate:reload":a[2]||(a[2]=s=>k.value=s),tabIndex:o(v),"onUpdate:tabIndex":a[3]||(a[3]=s=>re(v)?v.value=s:null),onBeforeSave:fe,onAfterSave:J},null,8,["docname","tabs","reload","tabIndex"])]),_:1},8,["modelValue","tabs"]),n(be,{class:"flex flex-col justify-between border-l",side:"right"},{default:_(()=>[r("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium text-ink-gray-9",onClick:a[5]||(a[5]=s=>o(He)(h.leadId))},L(e.__(h.leadId)),1),n(o(ba),{onSuccess:a[7]||(a[7]=s=>U("image",s.file_url)),validateFile:o(Xe)},{default:_(({openFileSelector:s,error:x})=>[r("div",Fa,[r("div",Oa,[n(o(Ye),{size:"3xl",class:"size-12",label:m.value,image:l.value.image},null,8,["label","image"]),(u(),c(ua(l.value.image?o(ne):"div"),ra(l.value.image?{options:[{icon:"upload",label:l.value.image?e.__("Change image"):e.__("Upload image"),onClick:s},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>U("image","")}]}:{onClick:s},{class:"!absolute bottom-0 left-0 right-0"}),{default:_(()=>[r("div",Pa,[n(De,{class:"size-4 cursor-pointer text-white"})])]),_:1},16))]),r("div",Ua,[n(o(da),{text:l.value.lead_name||e.__("Set first name")},{default:_(()=>[r("div",Na,L(m.value),1)]),_:1},8,["text"]),r("div",Ba,[o(va)?(u(),c(d,{key:0,tooltip:e.__("Make a call"),icon:Ee,onClick:()=>l.value.mobile_no?o(j)(l.value.mobile_no):o(S).error(e.__("No phone number set"))},null,8,["tooltip","onClick"])):f("",!0),n(d,{tooltip:e.__("Send an email"),icon:Ie,onClick:T=>l.value.email?ve():o(S).error(e.__("No email set"))},null,8,["tooltip","onClick"]),n(d,{tooltip:e.__("Go to website"),icon:Te,onClick:T=>l.value.website?o(Je)(l.value.website):o(S).error(e.__("No website set"))},null,8,["tooltip","onClick"]),n(d,{tooltip:e.__("Attach a file"),icon:te,onClick:a[6]||(a[6]=T=>O.value=!0)},null,8,["tooltip"]),n(d,{tooltip:e.__("Delete"),variant:"subtle",theme:"red",icon:"trash-2",onClick:ae},null,8,["tooltip"])]),n(P,{message:e.__(x)},null,8,["message"])])])]),_:1},8,["validateFile"]),l.value.sla_status?(u(),c(Me,{key:0,modelValue:l.value,"onUpdate:modelValue":a[8]||(a[8]=s=>l.value=s),onUpdateField:U},null,8,["modelValue"])):f("",!0),o(Y).data?(u(),q("div",ja,[n(Fe,{sections:o(Y).data,doctype:"CRM Lead",docname:h.leadId,onReload:o(Y).reload,onAfterFieldChange:J},null,8,["sections","docname","onReload"])])):f("",!0)]),_:1})])):p.value?(u(),c(ge,{key:1,errorTitle:p.value,errorMessage:A.value},null,8,["errorTitle","errorMessage"])):f("",!0),$.value?(u(),c(za,{key:2,modelValue:$.value,"onUpdate:modelValue":a[9]||(a[9]=s=>$.value=s),lead:l.value},null,8,["modelValue","lead"])):f("",!0),n(ke,{modelValue:O.value,"onUpdate:modelValue":a[10]||(a[10]=s=>O.value=s),doctype:"CRM Lead",docname:h.leadId,onAfter:a[11]||(a[11]=()=>{var s,x;(x=(s=g.value)==null?void 0:s.all_activities)==null||x.reload(),o(me)("attachments")})},null,8,["modelValue","docname"]),y.value?(u(),c(_e,{key:3,modelValue:y.value,"onUpdate:modelValue":a[12]||(a[12]=s=>y.value=s),doctype:"CRM Lead",docname:h.leadId,name:"Leads"},null,8,["modelValue","docname"])):f("",!0)],64)}}};export{Ft as default};
//# sourceMappingURL=Lead-680e18ff.js.map
