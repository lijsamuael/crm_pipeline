{"version":3,"file":"KanbanView-02bf94c0.js","sources":["../../../../frontend/src/components/Kanban/KanbanView.vue"],"sourcesContent":["<template>\n  <div class=\"flex overflow-x-auto h-full\">\n    <Draggable\n      v-if=\"columns\"\n      :list=\"columns\"\n      item-key=\"column\"\n      @end=\"updateColumn\"\n      :delay=\"isTouchScreenDevice() ? 200 : 0\"\n      class=\"flex sm:mx-2.5 mx-2 pb-3.5\"\n    >\n      <template #item=\"{ element: column }\">\n        <div\n          v-if=\"!column.column.delete\"\n          class=\"flex flex-col gap-2.5 min-w-72 w-72 hover:bg-surface-gray-2 rounded-lg p-2.5\"\n        >\n          <div class=\"flex gap-2 items-center group justify-between\">\n            <div class=\"flex items-center text-base\">\n              <Popover>\n                <template #target=\"{ togglePopover }\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    class=\"hover:!bg-surface-gray-2\"\n                    @click=\"togglePopover\"\n                  >\n                    <IndicatorIcon :class=\"parseColor(column.column.color)\" />\n                  </Button>\n                </template>\n                <template #body>\n                  <div\n                    class=\"flex flex-col gap-3 px-3 py-2.5 min-w-40 rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none\"\n                  >\n                    <div class=\"flex gap-1\">\n                      <Button\n                        variant=\"ghost\"\n                        v-for=\"color in colors\"\n                        :key=\"color\"\n                        @click=\"() => (column.column.color = color)\"\n                      >\n                        <IndicatorIcon :class=\"parseColor(color)\" />\n                      </Button>\n                    </div>\n                    <div class=\"flex flex-row-reverse\">\n                      <Button\n                        variant=\"solid\"\n                        :label=\"__('Apply')\"\n                        @click=\"updateColumn\"\n                      />\n                    </div>\n                  </div>\n                </template>\n              </Popover>\n              <div class=\"text-ink-gray-9\">{{ column.column.name }}</div>\n            </div>\n            <div class=\"flex\">\n              <Dropdown :options=\"actions(column)\">\n                <template #default>\n                  <Button\n                    class=\"opacity-0 group-hover:opacity-100 pointer-events-none group-hover:pointer-events-auto transition-opacity\"\n                    icon=\"more-horizontal\"\n                    variant=\"ghost\"\n                  />\n                </template>\n              </Dropdown>\n              <Button\n                icon=\"plus\"\n                variant=\"ghost\"\n                @click=\"options.onNewClick(column)\"\n              />\n            </div>\n          </div>\n          <div class=\"overflow-y-auto flex flex-col gap-2 h-full\">\n            <Draggable\n              :list=\"column.data\"\n              group=\"fields\"\n              item-key=\"name\"\n              class=\"flex flex-col gap-3.5 flex-1\"\n              @end=\"updateColumn\"\n              :delay=\"isTouchScreenDevice() ? 200 : 0\"\n              :data-column=\"column.column.name\"\n            >\n              <template #item=\"{ element: fields }\">\n                <component\n                  :is=\"options.getRoute ? 'router-link' : 'div'\"\n                  class=\"pt-3 px-3.5 pb-2.5 rounded-lg border bg-surface-white text-base flex flex-col text-ink-gray-9\"\n                  :data-name=\"fields.name\"\n                  v-bind=\"{\n                    to: options.getRoute ? options.getRoute(fields) : undefined,\n                    onClick: options.onClick\n                      ? () => options.onClick(fields)\n                      : undefined,\n                  }\"\n                >\n                  <slot\n                    name=\"title\"\n                    v-bind=\"{ fields, titleField, itemName: fields.name }\"\n                  >\n                    <div class=\"h-5 flex items-center\">\n                      <div v-if=\"fields[titleField]\">\n                        {{ fields[titleField] }}\n                      </div>\n                      <div class=\"text-ink-gray-4\" v-else>\n                        {{ __('No Title') }}\n                      </div>\n                    </div>\n                  </slot>\n                  <div class=\"border-b h-px my-2.5\" />\n\n                  <div class=\"flex flex-col gap-3.5\">\n                    <template v-for=\"value in column.fields\" :key=\"value\">\n                      <slot\n                        name=\"fields\"\n                        v-bind=\"{\n                          fields,\n                          fieldName: value,\n                          itemName: fields.name,\n                        }\"\n                      >\n                        <div v-if=\"fields[value]\" class=\"truncate\">\n                          {{ fields[value] }}\n                        </div>\n                      </slot>\n                    </template>\n                  </div>\n                  <div class=\"border-b h-px mt-2.5 mb-2\" />\n                  <slot name=\"actions\" v-bind=\"{ itemName: fields.name }\">\n                    <div class=\"flex gap-2 items-center justify-between\">\n                      <div></div>\n                      <Button icon=\"plus\" variant=\"ghost\" @click.stop.prevent />\n                    </div>\n                  </slot>\n                </component>\n              </template>\n            </Draggable>\n            <div\n              v-if=\"column.column.count < column.column.all_count\"\n              class=\"flex items-center justify-center\"\n            >\n              <Button\n                :label=\"__('Load More')\"\n                @click=\"emit('loadMore', column.column.name)\"\n              />\n            </div>\n          </div>\n        </div>\n      </template>\n    </Draggable>\n    <div v-if=\"deletedColumns.length\" class=\"shrink-0 min-w-64\">\n      <Autocomplete\n        value=\"\"\n        :options=\"deletedColumns\"\n        @change=\"(e) => addColumn(e)\"\n      >\n        <template #target=\"{ togglePopover }\">\n          <Button\n            class=\"w-full mt-2.5 mb-1 mr-5\"\n            :label=\"__('Add Column')\"\n            iconLeft=\"plus\"\n            @click=\"togglePopover()\"\n          />\n        </template>\n      </Autocomplete>\n    </div>\n  </div>\n</template>\n<script setup>\nimport Autocomplete from '@/components/frappe-ui/Autocomplete.vue'\nimport IndicatorIcon from '@/components/Icons/IndicatorIcon.vue'\nimport { isTouchScreenDevice, colors, parseColor } from '@/utils'\nimport Draggable from 'vuedraggable'\nimport { Dropdown, Popover } from 'frappe-ui'\nimport { computed } from 'vue'\n\nconst props = defineProps({\n  options: {\n    type: Object,\n    default: () => ({\n      getRoute: null,\n      onClick: null,\n      onNewClick: null,\n    }),\n  },\n})\n\nconst emit = defineEmits(['update', 'loadMore'])\n\nconst kanban = defineModel()\n\nconst titleField = computed(() => {\n  return kanban.value?.data?.title_field\n})\n\nconst columns = computed(() => {\n  if (!kanban.value?.data?.data || kanban.value.data.view_type != 'kanban')\n    return []\n  let _columns = kanban.value.data.data\n\n  // let has_color = _columns.some((column) => column.column?.color)\n  // if (!has_color) {\n  //   _columns.forEach((column, i) => {\n  //     column.column['color'] = colors[i % colors.length]\n  //   })\n  // }\n  return _columns\n})\n\nconst deletedColumns = computed(() => {\n  return columns.value\n    .filter((col) => col.column['delete'])\n    .map((col) => {\n      return { label: col.column.name, value: col.column.name }\n    })\n})\n\nfunction actions(column) {\n  return [\n    {\n      group: __('Options'),\n      hideLabel: true,\n      items: [\n        {\n          label: __('Delete'),\n          icon: 'trash-2',\n          onClick: () => {\n            column.column['delete'] = true\n            updateColumn()\n          },\n        },\n      ],\n    },\n  ]\n}\n\nfunction addColumn(e) {\n  let column = columns.value.find((col) => col.column.name == e.value)\n  column.column['delete'] = false\n  updateColumn()\n}\n\nfunction updateColumn(d) {\n  let toColumn = d?.to?.dataset.column\n  let fromColumn = d?.from?.dataset.column\n  let itemName = d?.item?.dataset.name\n\n  let _columns = []\n  columns.value.forEach((col) => {\n    col.column['order'] = col.data.map((d) => d.name)\n    if (col.column.page_length) {\n      delete col.column.page_length\n    }\n    _columns.push(col.column)\n  })\n\n  let data = { kanban_columns: _columns }\n\n  if (toColumn != fromColumn) {\n    data = { item: itemName, to: toColumn, kanban_columns: _columns }\n  }\n\n  emit('update', data)\n}\n</script>\n"],"names":["emit","__emit","kanban","_useModel","__props","titleField","computed","_b","_a","columns","deletedColumns","col","actions","column","updateColumn","addColumn","d","toColumn","fromColumn","itemName","_c","_columns","data","_openBlock","_createElementBlock","_hoisted_1","_createBlock","_unref","Draggable","isTouchScreenDevice","_withCtx","_hoisted_2","_createElementVNode","_hoisted_3","_hoisted_4","_createVNode","Popover","togglePopover","_component_Button","IndicatorIcon","parseColor","_hoisted_5","_hoisted_6","_Fragment","_renderList","colors","color","_normalizeClass","_hoisted_7","__","_hoisted_8","_toDisplayString","_hoisted_9","Dropdown","$event","_hoisted_10","fields","_resolveDynamicComponent","_mergeProps","_renderSlot","_ctx","_normalizeProps","_guardReactiveProps","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","value","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","Autocomplete","_cache","e"],"mappings":"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"}