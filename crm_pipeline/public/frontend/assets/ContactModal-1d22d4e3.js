import{F as I}from"./FieldLayout-07d47b2d.js";import{E as B}from"./EditIcon-6a53fdd3.js";import{u as N}from"./index-b783f1cf.js";import{i as Q}from"./DragVerticalIcon-708a426c.js";import{u as j,s as D,a as A,c as O,q as T}from"./modals-82c09976.js";import{_ as q,N as F,aK as P,O as R,l as S,X as U,a as z,G as b,e as v,f as m,g as p,w as G,d as n,t as K,u as d,B as h,b as C,aQ as L,aT as X}from"./index-ff0be78c.js";const $={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},H={class:"mb-5 flex items-center justify-between"},J={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},W={class:"flex items-center gap-1"},Y={class:"px-4 pb-7 pt-4 sm:px-6"},Z={class:"space-y-2"},ee={__name:"ContactModal",props:F({contact:{type:Object,default:{}},options:{type:Object,default:{redirect:!0,afterInsert:()=>{}}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(_){const c=_,{isManager:g}=N(),k=P(),l=R(_,"modelValue"),x=S(!1),{document:e,triggerOnBeforeCreate:r}=j("Contact");async function w(){e.doc.email_id&&(e.doc.email_ids=[{email_id:e.doc.email_id,is_primary:1}],delete e.doc.email_id),e.doc.mobile_no&&(e.doc.phone_nos=[{phone:e.doc.mobile_no,is_primary_mobile_no:1}],delete e.doc.mobile_no),await(r==null?void 0:r());const t=await L("frappe.client.insert",{doc:{doctype:"Contact",...e.doc}});t.name&&(X("contact_created"),M(t))}function M(t){var o,s;(s=(o=c.contact)==null?void 0:o.reload)==null||s.call(o),t.name&&c.options.redirect&&k.push({name:"Contact",params:{contactId:t.name}}),l.value=!1,c.options.afterInsert&&c.options.afterInsert(t)}const f=U({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","Contact"],params:{doctype:"Contact",type:"Quick Entry"},auto:!0,transform:t=>t.forEach(o=>{o.sections.forEach(s=>{s.columns.forEach(u=>{u.fields.forEach(a=>{a.fieldname=="email_id"||a.fieldname=="mobile_no"?a.read_only=!1:a.fieldname=="address"?(a.create=(i,V)=>{e.doc.address=i,y(),V()},a.edit=i=>y(i)):a.fieldtype==="Table"&&(e.doc[a.fieldname]=[])})})})})});z(()=>{e.doc={},Object.assign(e.doc,c.contact.data||c.contact)});function E(){O.value=!0,T.value={doctype:"Contact"},b(()=>l.value=!1)}function y(t){D.value=!0,A.value={doctype:"Address",address:t},b(()=>l.value=!1)}return(t,o)=>{const s=v("Button"),u=v("Dialog");return m(),p(u,{modelValue:l.value,"onUpdate:modelValue":o[1]||(o[1]=a=>l.value=a),options:{size:"xl"}},{body:G(()=>{var a;return[n("div",$,[n("div",H,[n("div",null,[n("h3",J,K(t.__("New Contact")),1)]),n("div",W,[d(g)()&&!d(Q)?(m(),p(s,{key:0,variant:"ghost",class:"w-7",tooltip:t.__("Edit fields layout"),icon:B,onClick:E},null,8,["tooltip"])):h("",!0),C(s,{variant:"ghost",class:"w-7",onClick:o[0]||(o[0]=i=>l.value=!1),icon:"x"})])]),(a=d(f).data)!=null&&a.length?(m(),p(I,{key:0,tabs:d(f).data,data:d(e).doc,doctype:"Contact"},null,8,["tabs","data"])):h("",!0)]),n("div",Y,[n("div",Z,[C(s,{class:"w-full",variant:"solid",label:t.__("Create"),loading:x.value,onClick:w},null,8,["label","loading"])])])]}),_:1},8,["modelValue"])}}},le=q(ee,[["__scopeId","data-v-179103b7"]]);export{le as C};
//# sourceMappingURL=ContactModal-1d22d4e3.js.map
