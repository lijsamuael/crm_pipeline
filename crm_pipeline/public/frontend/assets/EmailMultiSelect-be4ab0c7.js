import{_ as Z,f,c as w,aW as ee,N as te,O as ae,y as V,l as c,X as le,b7 as oe,d as C,F as D,r as H,b as d,w as v,u as p,g as E,B as N,t as L,G as q,e as K,a1 as m,n as G,aM as $,aB as ne}from"./index-ff0be78c.js";import{u as se,_ as re}from"./index-b783f1cf.js";import{C as ue,a as ie,b as ce,c as de,d as fe,e as ve,f as pe,g as me}from"./ComboboxViewport-10647930.js";const he={},ge={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function xe(u,k){return f(),w("svg",ge,[...k[0]||(k[0]=[ee('<g clip-path="url(#clip0_1191_1930)"><path d="M1.45001 12.1V12.1C1.45001 11.7869 1.60364 11.4936 1.86111 11.3154L6.87595 7.84359C7.52855 7.39178 8.38658 7.36866 9.06257 7.78465L13.5984 10.5759C14.1276 10.9016 14.45 11.4786 14.45 12.1V12.1" stroke="currentColor"></path><path d="M14.45 7.60001L11.95 9.60001M4.45001 9.60001L1.45001 7.60001" stroke="currentColor"></path><path d="M4 9V3C4 2.44772 4.44772 2 5 2H11C11.5523 2 12 2.44772 12 3V9" stroke="currentColor"></path><path d="M4 4.49999L2.1786 6C1.71727 6.37992 1.45002 6.94623 1.45002 7.54385L1.45002 12.1C1.45002 13.2046 2.34545 14.1 3.45002 14.1L12.45 14.1C13.5546 14.1 14.45 13.2046 14.45 12.1V7.51988C14.45 6.93603 14.1949 6.38133 13.7516 6.00137L12 4.5" stroke="currentColor"></path><path d="M6 6H10" stroke="currentColor" stroke-linecap="round"></path><path d="M6 4H9" stroke="currentColor" stroke-linecap="round"></path></g>',1)])])}const Le=Z(he,[["render",xe]]),be={class:"flex flex-wrap gap-1"},ye={class:"flex-1"},_e={class:"flex flex-col gap-1 p-1 text-ink-gray-8"},Ce={class:"text-base font-medium"},we={class:"text-sm text-ink-gray-5"},ke={key:1,class:"whitespace-pre-line text-sm text-ink-blue-3 mt-2 pl-2"},Se={__name:"EmailMultiSelect",props:te({mode:{type:String,default:null},fetchUsers:{type:Boolean,default:!1},fetchContacts:{type:Boolean,default:!1},existingEmails:{type:Array,default:()=>[]},validate:{type:Function,default:null},errorMessage:{type:Function,default:u=>`${u} is an Invalid value`},emptyPlaceholder:{type:String,default:__("No results found")},variant:{type:String,default:"subtle"},placeholder:{type:String,default:""},inputClass:{type:String,default:""}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u,{expose:k}){const s=u,i=ae(u,"modelValue"),x=V(()=>s.mode?s.mode:s.fetchUsers?"users":s.fetchContacts?"contacts":"free"),b=c([]),O=c(null),y=c(null),M=c(null),o=c(""),_=c(!1),P=c(null),{users:S}=se(),h=c(null),T=c("");x.value==="contacts"&&(h.value=le({url:"crm.api.contact.search_emails",method:"POST",cache:["ContactEmails"],params:{txt:""},transform:e=>{var r;let t=(e||[]).map(l=>{const n=l[0],a=l[1],g=l[2];return{label:n||g||a,value:a}});return(r=s.existingEmails)!=null&&r.length&&(t=t.filter(l=>!s.existingEmails.includes(l.value))),t}}),oe(o,e=>{var t;e=e||"",!(T.value===e&&((t=B.value)!=null&&t.length))&&(T.value=e,Q(e))},{debounce:300,immediate:!0}));function Q(e){x.value!=="contacts"||!h.value||(h.value.update({params:{txt:e}}),h.value.reload())}const B=V(()=>{var t,r,l;const e=x.value;if(e==="users"){let n=((t=S==null?void 0:S.data)==null?void 0:t.allUsers)||[];if(n=n.map(a=>({label:a.full_name||a.name||a.email,value:a.email})),(r=s.existingEmails)!=null&&r.length&&(n=n.filter(a=>!s.existingEmails.includes(a.value))),o.value){const a=o.value.toLowerCase();n=n.filter(g=>{var A,z;return((A=g.label)==null?void 0:A.toLowerCase().includes(a))||((z=g.value)==null?void 0:z.toLowerCase().includes(a))})}return n}if(e==="contacts"){const n=(l=h.value)!=null&&l.data?[...h.value.data]:[];return!n.length&&o.value&&n.push({label:o.value,value:o.value}),n}return o.value?[{label:o.value,value:o.value}]:[]}),R=V(()=>x.value!=="free"),W=V(()=>x.value==="free"?__(s.emptyPlaceholder):B.value.length?"":__(s.emptyPlaceholder));function X(e){var r;if(!e)return;y.value=null,M.value=null;const t=e.split(",").map(l=>l.trim()).filter(Boolean);for(const l of t){if((r=i.value)!=null&&r.includes(l)){M.value=__("email already exists");continue}if(s.validate&&!s.validate(l)){y.value=s.errorMessage(l),o.value=l;break}i.value?i.value.push(l):i.value=[l]}}function j(e){i.value=i.value.filter(t=>t!==e)}function U(){var t;if(o.value)return;let e=(t=b.value[b.value.length-1])==null?void 0:t.rootRef;document.activeElement===e?(i.value.pop(),q(()=>{i.value.length?(e=b.value[b.value.length-1].rootRef,e==null||e.focus()):F()})):e==null||e.focus()}function F(){var e,t;(t=(e=O.value)==null?void 0:e.focus)==null||t.call(e)}k({setFocus:F});function J(e){o.value=e.target.value,_.value=!0}function I(e){e&&(X(e),y.value||(o.value="",P.value=null,_.value=!1,q(()=>F())))}function Y(){o.value&&I(o.value)}return(e,t)=>{const r=K("FeatherIcon"),l=K("Button"),n=K("ErrorMessage");return f(),w("div",null,[C("div",be,[(f(!0),w(D,null,H(i.value,a=>(f(),E(l,{ref_for:!0,ref_key:"emails",ref:b,key:a,label:a,theme:"gray",variant:"subtle",class:G({"rounded bg-surface-white hover:!bg-surface-gray-1 focus-visible:ring-outline-gray-4":u.variant==="subtle"}),onKeydownCapture:$(m(U,["stop"]),["delete"])},{suffix:v(()=>[d(r,{class:"h-3.5",name:"x",onClick:m(g=>j(a),["stop"])},null,8,["onClick"])]),_:2},1032,["label","class","onKeydownCapture"]))),128)),C("div",ye,[d(p(me),{"model-value":P.value,open:_.value,"onUpdate:open":t[3]||(t[3]=a=>_.value=a),"onUpdate:modelValue":I,"ignore-filter":!0},{default:v(()=>[d(p(ue),{class:G(["flex h-7 max-w-full w-auto items-center gap-2 rounded px-2 py-1 border border-transparent",[u.variant=="ghost"?"bg-surface-white hover:bg-surface-white":"bg-surface-gray-2 hover:bg-surface-gray-3",u.inputClass]])},{default:v(()=>[d(p(ie),{ref_key:"search",ref:O,value:o.value,autocomplete:"off",class:"bg-transparent p-0 outline-none border-0 text-base text-ink-gray-8 h-full placeholder:text-ink-gray-4 w-full focus:outline-none focus:ring-0 focus:border-0",placeholder:u.placeholder,onFocus:t[0]||(t[0]=a=>_.value=!0),onInput:J,onKeydownCapture:$(m(U,["stop"]),["delete"]),onKeydown:$(m(Y,["prevent"]),["enter"])},null,8,["value","placeholder","onKeydownCapture","onKeydown"])]),_:1},8,["class"]),d(p(ce),null,{default:v(()=>[d(p(de),{class:"z-10 mt-1 min-w-48 w-auto max-w-96 bg-surface-modal overflow-hidden rounded-lg shadow-2xl ring-1 ring-black ring-opacity-5",position:"popper",align:"start",onOpenAutoFocus:t[1]||(t[1]=m(()=>{},["prevent"])),onCloseAutoFocus:t[2]||(t[2]=m(()=>{},["prevent"]))},{default:v(()=>[d(p(fe),{class:"max-h-60 overflow-auto p-1.5"},{default:v(()=>[d(p(ve),{class:"flex gap-2 rounded px-2 py-1 text-base text-ink-gray-5"},{default:v(()=>[R.value?(f(),E(r,{key:0,name:"search",class:"h-4"})):N("",!0),ne(" "+L(W.value),1)]),_:1}),(f(!0),w(D,null,H(B.value,a=>(f(),E(p(pe),{key:a.value,value:a.value,class:"text-base leading-none text-ink-gray-7 rounded flex items-center px-2 py-1 relative select-none data-[highlighted]:outline-none data-[highlighted]:bg-surface-gray-3 cursor-pointer",onMousedown:m(g=>I(a.value),["prevent"])},{default:v(()=>[d(re,{class:"mr-2",user:a.value,size:"lg"},null,8,["user"]),C("div",_e,[C("div",Ce,L(a.label),1),C("div",we,L(a.value),1)])]),_:2},1032,["value","onMousedown"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value","open"])])]),y.value?(f(),E(n,{key:0,class:"mt-2 pl-2",message:y.value},null,8,["message"])):N("",!0),M.value?(f(),w("div",ke,L(M.value),1)):N("",!0)])}}};export{Le as E,Se as _};
//# sourceMappingURL=EmailMultiSelect-be4ab0c7.js.map
