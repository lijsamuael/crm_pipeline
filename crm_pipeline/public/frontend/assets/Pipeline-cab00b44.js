import{f as Ae}from"./DeleteLinkedDocModal-b8dea5ab.js";import{_ as Oe}from"./ErrorPage-7f4a64a0.js";import{_ as Ne}from"./Icon-cee465ab.js";import{_ as Ue}from"./Resizer-950d983d.js";import{A as ge,a as _e,u as Le,_ as Fe,b as ze,c as ye,S as qe}from"./useActiveTabManager-63a9398f.js";import{E as Be}from"./EmailIcon-370bbe59.js";import{E as je}from"./Email2Icon-809e3ded.js";import{C as Je}from"./CommentIcon-9a414213.js";import{D as ve}from"./DetailsIcon-5a609665.js";import{P as fe}from"./PhoneIcon-b924360f.js";import{T as We}from"./TaskIcon-70d1b497.js";import{N as Qe}from"./NoteModal-3f226d24.js";import{W as Ge}from"./WhatsAppIcon-b7d96857.js";import{I as Ke}from"./IndicatorIcon-b7908665.js";import{C as He}from"./CameraIcon-ebac4659.js";import{L as Xe}from"./LinkIcon-6eb44bc3.js";import{L as Ye}from"./LayoutHeader-35243543.js";import{g as Ze,S as et}from"./view-43a99589.js";import{_ as be}from"./CustomActions-7f5318cc.js";import{O as tt}from"./OrganizationsIcon-b4eec5b9.js";import{C as at}from"./ContactsIcon-a116f697.js";import{E as lt}from"./EditIcon-6a53fdd3.js";import{F as ot}from"./FieldLayout-07d47b2d.js";import{L as he}from"./Link-5295c6fd.js";import{u as de,c as st,q as it,_ as nt}from"./modals-82c09976.js";import{u as rt,e as xe,b as dt,s as ut,D as ke,i as ct,h as mt,a as pt,o as gt}from"./index-b783f1cf.js";import{N as _t,O as yt,aK as we,a0 as vt,l as y,y as z,X as Ve,e as Z,f as i,g,w,d as a,t as r,u as l,B as _,b as s,c as f,W as ft,aQ as ue,aT as bt,$ as ht,z as X,aR as P,aS as xt,aI as ne,F as re,n as kt,r as Ce,aV as Y,K as Ct,a6 as wt,Y as Vt,G as It}from"./index-ff0be78c.js";import{s as Ie}from"./statuses-b0067a06.js";import{i as St,w as Dt,c as Mt}from"./DragVerticalIcon-708a426c.js";import{u as $t}from"./helpCenter-a11378c4.js";import{g as Et}from"./settings-3c5e434a.js";import{g as Pt}from"./global-42495688.js";import{_ as Tt}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-03576955.js";import{F as Rt}from"./FileUploader-82795769.js";import{u as At}from"./pageMeta-10bf9f4c.js";import"./CalendarIcon-9e8ce055.js";import"./CallLogModal-1192c294.js";import"./ArrowUpRightIcon-0c79d19a.js";import"./LeadsIcon-f4771b19.js";import"./DealsIcon-8fdb442c.js";import"./TaskModal-f263026e.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-21ccd175.js";import"./FadedScrollableDiv-00bdffd8.js";import"./MultipleAvatar-b7b859f9.js";import"./event-5217d446.js";import"./ComboboxViewport-10647930.js";import"./IconPicker-ad835b7e.js";import"./EmailMultiSelect-be4ab0c7.js";const Ot={class:"mb-6 flex items-center justify-between"},Nt={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},Ut={class:"flex items-center gap-1"},Lt={class:"mb-4 flex items-center gap-2 text-ink-gray-5"},Ft={class:"block text-base"},zt={class:"ml-6 text-ink-gray-9"},qt={class:"flex items-center justify-between text-base"},Bt={key:1,class:"mt-2.5 text-base"},jt={class:"mb-4 mt-6 flex items-center gap-2 text-ink-gray-5"},Jt={class:"block text-base"},Wt={class:"ml-6 text-ink-gray-9"},Qt={class:"flex items-center justify-between text-base"},Gt={key:1,class:"mt-2.5 text-base"},Kt={key:0,class:"h-px w-full border-t my-6"},Ht={class:"flex justify-end"},Xt={__name:"ConvertPipelineToDealModal",props:_t({pipeline:{type:Object,required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(V){const j=V,O=yt(V,"modelValue"),ee=we(),{statusOptions:te,getDealStatus:ae}=Ie(),{isManager:le}=rt(),{user:oe}=vt(),{updateOnboardingStep:N}=$t("frappecrm"),U=y(!1),D=y(!1),b=y(""),h=y(""),v=y(""),{triggerConvertToDeal:F}=de("CRM Pipeline",j.pipeline.name),{document:I}=de("CRM Deal");async function q(){if(v.value="",U.value&&!b.value){v.value=__("Please select an existing contact");return}if(D.value&&!h.value){v.value=__("Please select an existing organization");return}!U.value&&b.value&&(b.value=""),!D.value&&h.value&&(h.value=""),await(F==null?void 0:F(j.pipeline,I.doc,()=>O.value=!1));let d=await ue("crm_pipeline.api.convert_to_deal",{pipeline:j.pipeline.name,deal:I.doc,existing_contact:b.value,existing_organization:h.value}).catch(u=>{var S;if(u.exc_type=="MandatoryError"){const p=u.messages.map(x=>{let R=x.split(": ");return R[R.length-1].trim()}).join(", ");p.toLowerCase().includes("required")?v.value=__(p):v.value=__("{0} is required",[p]);return}v.value=__("Error converting to deal: {0}",[(S=u.messages)==null?void 0:S[0]])});d&&(O.value=!1,U.value=!1,D.value=!1,b.value="",h.value="",v.value="",N("convert_pipeline_to_deal",!0,!1,()=>{localStorage.setItem("firstDeal"+oe,d)}),bt("convert_pipeline_to_deal"),ee.push({name:"Deal",params:{dealId:d}}))}const J=z(()=>{var u;let d=te("deal");return(u=I.doc)!=null&&u.status||(I.doc.status=d[0].value),d}),M=Ve({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["RequiredFields","CRM Deal"],params:{doctype:"CRM Deal",type:"Required Fields"},auto:!0,transform:d=>{let u=!1,S=d==null?void 0:d.forEach(p=>{var x;(x=p.sections)==null||x.forEach(R=>{var o;(o=R.columns)==null||o.forEach(se=>{var B;(B=se.fields)==null||B.forEach(k=>{u=!0,k.fieldname=="status"&&(k.fieldtype="Select",k.options=J.value,k.prefix=ae(I.doc.status).color),k.fieldtype==="Table"&&(I.doc[k.fieldname]=[])})})})});return u?S:[]}});function T(){st.value=!0,it.value={doctype:"CRM Deal",onlyRequired:!0},O.value=!1}return(d,u)=>{const S=Z("Button"),p=Z("ErrorMessage");return i(),g(l(ft),{modelValue:O.value,"onUpdate:modelValue":u[5]||(u[5]=x=>O.value=x),options:{size:"xl"}},{"body-header":w(()=>[a("div",Ot,[a("div",null,[a("h3",Nt,r(d.__("Convert to Deal")),1)]),a("div",Ut,[l(le)()&&!l(St)?(i(),g(S,{key:0,variant:"ghost",tooltip:d.__("Edit deal's mandatory fields layout"),icon:lt,onClick:T},null,8,["tooltip"])):_("",!0),s(S,{icon:"x",variant:"ghost",onClick:u[0]||(u[0]=x=>O.value=!1)})])])]),"body-content":w(()=>{var x,R;return[a("div",Lt,[s(tt,{class:"h-4 w-4"}),a("label",Ft,r(d.__("Organization")),1)]),a("div",zt,[a("div",qt,[a("div",null,r(d.__("Choose Existing")),1),s(l(xe),{modelValue:D.value,"onUpdate:modelValue":u[1]||(u[1]=o=>D.value=o)},null,8,["modelValue"])]),D.value?(i(),g(he,{key:0,class:"form-control mt-2.5",size:"md",value:h.value,doctype:"CRM Organization",onChange:u[2]||(u[2]=o=>h.value=o)},null,8,["value"])):(i(),f("div",Bt,r(d.__("New organization will be created based on the data in details section")),1))]),a("div",jt,[s(at,{class:"h-4 w-4"}),a("label",Jt,r(d.__("Contact")),1)]),a("div",Wt,[a("div",Qt,[a("div",null,r(d.__("Choose Existing")),1),s(l(xe),{modelValue:U.value,"onUpdate:modelValue":u[3]||(u[3]=o=>U.value=o)},null,8,["modelValue"])]),U.value?(i(),g(he,{key:0,class:"form-control mt-2.5",size:"md",value:b.value,doctype:"Contact",onChange:u[4]||(u[4]=o=>b.value=o)},null,8,["value"])):(i(),f("div",Gt,r(d.__("New contact will be created based on the person's details")),1))]),(x=l(M).data)!=null&&x.length?(i(),f("div",Kt)):_("",!0),(R=l(M).data)!=null&&R.length?(i(),g(ot,{key:1,tabs:l(M).data,data:l(I).doc,doctype:"CRM Deal"},null,8,["tabs","data"])):_("",!0),s(p,{class:"mt-4",message:v.value},null,8,["message"])]}),actions:w(()=>[a("div",Ht,[s(S,{label:d.__("Convert"),variant:"solid",onClick:q},null,8,["label"])])]),_:1},8,["modelValue"])}}},Yt={key:0,class:"flex h-full overflow-hidden"},Zt={key:1,class:"p-5"},ea={class:"flex items-center justify-between mb-4"},ta={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},aa={class:"border rounded-lg overflow-hidden border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},la={class:"w-full"},oa={class:"bg-gray-50 dark:bg-gray-700"},sa={class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},ia={class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},na={class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},ra={class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},da={class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},ua={class:"divide-y divide-gray-200 dark:divide-gray-600"},ca={class:"px-4 py-3"},ma={class:"px-4 py-3"},pa={class:"px-4 py-3"},ga={class:"px-4 py-3"},_a={class:"px-4 py-3"},ya={key:0},va={colspan:"5",class:"px-4 py-8 text-center text-gray-500 dark:text-gray-400"},fa={key:2,class:"p-5"},ba={class:"flex items-center justify-between mb-4"},ha={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},xa={class:"border rounded-lg overflow-hidden border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},ka={class:"w-full"},Ca={class:"bg-gray-50 dark:bg-gray-700"},wa={class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},Va={class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},Ia={class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},Sa={class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},Da={class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},Ma={class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},$a={class:"divide-y divide-gray-200 dark:divide-gray-600"},Ea={class:"px-4 py-3 text-gray-900 dark:text-gray-100"},Pa={class:"px-4 py-3 text-gray-900 dark:text-gray-100"},Ta={class:"px-4 py-3 text-gray-900 dark:text-gray-100"},Ra={class:"px-4 py-3 text-gray-900 dark:text-gray-100"},Aa={class:"px-4 py-3 text-gray-900 dark:text-gray-100"},Oa={class:"px-4 py-3"},Na={key:0},Ua={colspan:"6",class:"px-4 py-8 text-center text-gray-500 dark:text-gray-400"},La={class:"flex items-center justify-start gap-5 border-b border-gray-200 dark:border-gray-700 p-5"},Fa={class:"group relative size-12"},za={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 dark:bg-white dark:bg-opacity-20 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},qa={class:"flex flex-col gap-2.5 truncate"},Ba={class:"truncate text-2xl font-medium text-gray-900 dark:text-gray-100"},ja={class:"flex gap-1.5"},Ja={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},Fl={__name:"Pipeline",props:{pipelineId:{type:String,required:!0}},setup(V){const{brand:j}=Et(),{$dialog:O,$socket:ee,makeCall:te}=Pt(),{statusOptions:ae,getPipelineStatus:le}=Ie(),{doctypeMeta:oe}=dt("CRM Pipeline"),N=ht(),U=we(),D=V,b=y(!1),h=y(null),v=y(""),F=y(""),I=y(!1),q=y(!1),J=y(!1),M=y([]),T=y([]),d=y(!1),{triggerOnChange:u,assignees:S,document:p,scripts:x,error:R}=de("CRM Pipeline",D.pipelineId),o=z(()=>p.doc||{});X(o,e=>{e&&(M.value=e.deals?JSON.parse(JSON.stringify(e.deals)):[],T.value=e.logs?JSON.parse(JSON.stringify(e.logs)):[],d.value=!1)},{immediate:!0,deep:!0}),X([M,T],([e,t],[m,L])=>{Se()},{deep:!0});const se=z(()=>ae("pipeline").map(e=>({...e,onClick:()=>$e(e.value)}))),B=z(()=>k.value[$.value]),k=z(()=>[{name:"Activity",label:__("Activity"),icon:ge},{name:"DealTagging",label:__("Deal Tagging"),icon:ve},{name:"Logs",label:__("Status Logs"),icon:ge},{name:"Emails",label:__("Emails"),icon:Be},{name:"Comments",label:__("Comments"),icon:Je},{name:"Data",label:__("Data"),icon:ve},{name:"Calls",label:__("Calls"),icon:fe},{name:"Tasks",label:__("Tasks"),icon:We},{name:"Notes",label:__("Notes"),icon:Qe},{name:"Attachments",label:__("Attachments"),icon:_e},{name:"WhatsApp",label:__("WhatsApp"),icon:Ge,condition:()=>Dt.value}].filter(t=>t.condition?t.condition():!0));function Se(){const e=o.value.deals?JSON.parse(JSON.stringify(o.value.deals)):[],t=o.value.logs?JSON.parse(JSON.stringify(o.value.logs)):[],m=JSON.stringify(M.value)!==JSON.stringify(e),L=JSON.stringify(T.value)!==JSON.stringify(t);d.value=m||L}function De(e){M.value.splice(e,1)}function ce(e){if(!e)return"";try{const t=new Date(e);return isNaN(t.getTime())?e:t.toLocaleString()}catch{return e}}function Q(){}function Me(e){T.value.splice(e,1)}async function $e(e){try{await ue("crm_pipeline.api.update_pipeline_status",{pipeline_name:D.pipelineId,new_status:e}),P.success(__("Status updated successfully")),p.reload()}catch(t){P.error(__("Failed to update status: {0}",[t.message]))}}async function Ee(){try{o.value.deals=M.value,o.value.logs=T.value,await p.save.submit(),d.value=!1,P.success(__("Changes saved successfully"))}catch(e){P.error(__("Failed to save changes: {0}",[e.message]))}}const{tabIndex:$,changeTabTo:Pe}=Le(k,"lastPipelineTab"),ie=Ve({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Pipeline"],params:{doctype:"CRM Pipeline"},auto:!0}),Te=z(()=>{let e=[{label:__("Pipelines"),route:{name:"Pipelines"}}];if(N.query.view||N.query.viewType){let t=Ze(N.query.view,N.query.viewType,"CRM Pipeline");t&&e.push({label:__(t.label),icon:t.icon,route:{name:"Pipelines",params:{viewType:N.query.viewType},query:{view:N.query.view}}})}return e.push({label:G.value,route:{name:"Pipeline",params:{pipelineId:D.pipelineId}}}),e}),G=z(()=>{var t,m;let e=((t=oe["CRM Pipeline"])==null?void 0:t.title_field)||"name";return((m=o.value)==null?void 0:m[e])||D.pipelineId});At(()=>({title:G.value,icon:j.favicon})),X(R,e=>{var t;e?(v.value=__(e.exc_type=="DoesNotExistError"?"Document not found":"Error occurred"),F.value=__(((t=e.messages)==null?void 0:t[0])||"An error occurred")):(v.value="",F.value="")}),X(()=>p.doc,async e=>{var t;if((t=x.data)!=null&&t.length){let m=await ut(x.data,{doc:e,$dialog:O,$socket:ee,router:U,toast:P,updateField:K,createToast:P.create,deleteDoc:me,call:ue});p._actions=m.actions||[],p._statuses=m.statuses||[]}},{once:!0});function K(e,t){t=Array.isArray(e)?"":t;let m=Array.isArray(e)?{}:o.value[e];Array.isArray(e)?e.forEach(L=>o.value[L]=t):o.value[e]=t,p.save.submit(null,{onSuccess:()=>b.value=!0,onError:L=>{var n;Array.isArray(e)?e.forEach(C=>o.value[C]=m[C]):o.value[e]=m,P.error(((n=L.messages)==null?void 0:n[0])||__("Error updating field"))}})}function me(){I.value=!0}function Re(){let e=k.value[$.value];["Emails","Comments","Activities"].includes(e.name)||h.value.changeTabTo("emails"),It(()=>h.value.emailBox.show=!0)}function pe(e){p.save.submit(null,{onSuccess:()=>H(e)})}function H(e){e!=null&&e.hasOwnProperty("pipeline_owner")&&S.reload()}return(e,t)=>{const m=Z("Button"),L=Z("ErrorMessage");return i(),f(re,null,[s(Ye,null,xt({"left-header":w(()=>[s(l(Tt),{items:Te.value},{prefix:w(({item:n})=>[n.icon?(i(),g(Ne,{key:0,icon:n.icon,class:"mr-2 h-4"},null,8,["icon"])):_("",!0)]),_:1},8,["items"])]),_:2},[v.value?void 0:{name:"right-header",fn:w(()=>{var n,C;return[(n=l(p)._actions)!=null&&n.length?(i(),g(be,{key:0,actions:l(p)._actions},null,8,["actions"])):_("",!0),(C=l(p).actions)!=null&&C.length?(i(),g(be,{key:1,actions:l(p).actions},null,8,["actions"])):_("",!0),s(ze,{modelValue:l(S).data,"onUpdate:modelValue":t[0]||(t[0]=E=>l(S).data=E),doctype:"CRM Pipeline",docname:V.pipelineId},null,8,["modelValue","docname"]),s(l(ke),{options:se.value,placement:"right"},{default:w(({open:E})=>[s(m,{label:e.__("Change Status"),iconRight:E?"chevron-up":"chevron-down",variant:"outline"},{prefix:w(()=>[s(Ke,{class:kt(l(le)(o.value.status).color)},null,8,["class"])]),_:1},8,["label","iconRight"])]),_:1},8,["options"]),s(m,{label:e.__("Convert to Deal"),variant:"solid",onClick:t[1]||(t[1]=E=>q.value=!0)},null,8,["label"]),d.value?(i(),g(m,{key:2,label:e.__("Save"),variant:"solid",theme:"green",onClick:Ee,loading:l(p).save.loading},null,8,["label","loading"])):_("",!0)]}),key:"0"}]),1024),o.value.name?(i(),f("div",Yt,[s(l(nt),{as:"div",modelValue:l($),"onUpdate:modelValue":t[6]||(t[6]=n=>ne($)?$.value=n:null),tabs:k.value},{"tab-panel":w(()=>{var n,C,E;return[((n=B.value)==null?void 0:n.name)==="Activity"?(i(),g(ye,{key:0,ref_key:"activities",ref:h,doctype:"CRM Pipeline",docname:V.pipelineId,tabs:k.value,reload:b.value,"onUpdate:reload":t[2]||(t[2]=c=>b.value=c),tabIndex:l($),"onUpdate:tabIndex":t[3]||(t[3]=c=>ne($)?$.value=c:null),onBeforeSave:pe,onAfterSave:H},null,8,["docname","tabs","reload","tabIndex"])):((C=B.value)==null?void 0:C.name)==="DealTagging"?(i(),f("div",Zt,[a("div",ea,[a("h3",ta,r(e.__("Deal Tagging")),1)]),a("div",aa,[a("table",la,[a("thead",oa,[a("tr",null,[a("th",sa,r(e.__("Deal")),1),a("th",ia,r(e.__("Deal Owner")),1),a("th",na,r(e.__("Deal Value")),1),a("th",ra,r(e.__("Probability")),1),a("th",da,r(e.__("Actions")),1)])]),a("tbody",ua,[(i(!0),f(re,null,Ce(M.value,(c,W)=>(i(),f("tr",{key:W,class:"hover:bg-gray-50 dark:hover:bg-gray-700"},[a("td",ca,[s(l(Y),{type:"text",modelValue:c.deal,"onUpdate:modelValue":A=>c.deal=A,onInput:Q,placeholder:e.__("Deal name"),class:"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),a("td",ma,[s(l(Y),{type:"text",modelValue:c.deal_owner,"onUpdate:modelValue":A=>c.deal_owner=A,onInput:Q,placeholder:e.__("Deal owner"),class:"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),a("td",pa,[s(l(Y),{type:"number",modelValue:c.deal_value,"onUpdate:modelValue":A=>c.deal_value=A,onInput:Q,placeholder:e.__("0.00"),class:"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),a("td",ga,[s(l(Y),{type:"number",modelValue:c.probability,"onUpdate:modelValue":A=>c.probability=A,onInput:Q,placeholder:e.__("0"),min:"0",max:"100",class:"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),a("td",_a,[s(m,{label:e.__("Delete"),variant:"subtle",theme:"red",icon:"trash-2",onClick:A=>De(W)},null,8,["label","onClick"])])]))),128)),M.value.length===0?(i(),f("tr",ya,[a("td",va,r(e.__("No deals tagged to this pipeline.")),1)])):_("",!0)])])])])):((E=B.value)==null?void 0:E.name)==="Logs"?(i(),f("div",fa,[a("div",ba,[a("h3",ha,r(e.__("Status Logs")),1)]),a("div",xa,[a("table",ka,[a("thead",Ca,[a("tr",null,[a("th",wa,r(e.__("From Status")),1),a("th",Va,r(e.__("To Status")),1),a("th",Ia,r(e.__("From Date")),1),a("th",Sa,r(e.__("To Date")),1),a("th",Da,r(e.__("Duration")),1),a("th",Ma,r(e.__("Actions")),1)])]),a("tbody",$a,[(i(!0),f(re,null,Ce(T.value,(c,W)=>(i(),f("tr",{key:W,class:"hover:bg-gray-50 dark:hover:bg-gray-700"},[a("td",Ea,r(c.from_status),1),a("td",Pa,r(c.to_status||"Current"),1),a("td",Ta,r(ce(c.from_date)),1),a("td",Ra,r(c.to_date?ce(c.to_date):"Ongoing"),1),a("td",Aa,r(c.duration),1),a("td",Oa,[s(m,{label:e.__("Delete"),variant:"subtle",theme:"red",icon:"trash-2",onClick:A=>Me(W)},null,8,["label","onClick"])])]))),128)),T.value.length===0?(i(),f("tr",Na,[a("td",Ua,r(e.__("No status logs available. Status changes will appear here automatically.")),1)])):_("",!0)])])])])):(i(),g(ye,{key:3,ref_key:"activities",ref:h,doctype:"CRM Pipeline",docname:V.pipelineId,tabs:k.value,reload:b.value,"onUpdate:reload":t[4]||(t[4]=c=>b.value=c),tabIndex:l($),"onUpdate:tabIndex":t[5]||(t[5]=c=>ne($)?$.value=c:null),onBeforeSave:pe,onAfterSave:H},null,8,["docname","tabs","reload","tabIndex"]))]}),_:1},8,["modelValue","tabs"]),s(Ue,{class:"flex flex-col justify-between border-l border-gray-200 dark:border-gray-700",side:"right"},{default:w(()=>[a("div",{class:"flex h-10.5 cursor-copy items-center border-b border-gray-200 dark:border-gray-700 px-5 py-2.5 text-lg font-medium text-gray-900 dark:text-gray-100",onClick:t[7]||(t[7]=n=>l(ct)(V.pipelineId))},r(e.__(V.pipelineId)),1),s(l(Rt),{onSuccess:t[9]||(t[9]=n=>K("image",n.file_url)),validateFile:l(mt)},{default:w(({openFileSelector:n,error:C})=>[a("div",La,[a("div",Fa,[s(l(pt),{size:"3xl",class:"size-12",label:G.value,image:o.value.image},null,8,["label","image"]),(i(),g(wt(o.value.image?l(ke):"div"),Ct(o.value.image?{options:[{icon:"upload",label:o.value.image?e.__("Change image"):e.__("Upload image"),onClick:n},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>K("image","")}]}:{onClick:n},{class:"!absolute bottom-0 left-0 right-0"}),{default:w(()=>[a("div",za,[s(He,{class:"size-4 cursor-pointer text-white dark:text-gray-100"})])]),_:1},16))]),a("div",qa,[s(l(Vt),{text:o.value.pipeline_name||e.__("Set name")},{default:w(()=>[a("div",Ba,r(G.value),1)]),_:1},8,["text"]),a("div",ja,[l(Mt)?(i(),g(m,{key:0,tooltip:e.__("Make a call"),icon:fe,onClick:()=>o.value.mobile_no?l(te)(o.value.mobile_no):l(P).error(e.__("No phone number set"))},null,8,["tooltip","onClick"])):_("",!0),s(m,{tooltip:e.__("Send an email"),icon:je,onClick:E=>o.value.email?Re():l(P).error(e.__("No email set"))},null,8,["tooltip","onClick"]),s(m,{tooltip:e.__("Go to website"),icon:Xe,onClick:E=>o.value.website?l(gt)(o.value.website):l(P).error(e.__("No website set"))},null,8,["tooltip","onClick"]),s(m,{tooltip:e.__("Attach a file"),icon:_e,onClick:t[8]||(t[8]=E=>J.value=!0)},null,8,["tooltip"]),s(m,{tooltip:e.__("Delete"),variant:"subtle",theme:"red",icon:"trash-2",onClick:me},null,8,["tooltip"])]),s(L,{message:e.__(C)},null,8,["message"])])])]),_:1},8,["validateFile"]),o.value.sla_status?(i(),g(qe,{key:0,modelValue:o.value,"onUpdate:modelValue":t[10]||(t[10]=n=>o.value=n),onUpdateField:K},null,8,["modelValue"])):_("",!0),l(ie).data?(i(),f("div",Ja,[s(et,{sections:l(ie).data,doctype:"CRM Pipeline",docname:V.pipelineId,onReload:l(ie).reload,onAfterFieldChange:H},null,8,["sections","docname","onReload"])])):_("",!0)]),_:1})])):v.value?(i(),g(Oe,{key:1,errorTitle:v.value,errorMessage:F.value},null,8,["errorTitle","errorMessage"])):_("",!0),q.value?(i(),g(Xt,{key:2,modelValue:q.value,"onUpdate:modelValue":t[11]||(t[11]=n=>q.value=n),pipeline:o.value},null,8,["modelValue","pipeline"])):_("",!0),s(Fe,{modelValue:J.value,"onUpdate:modelValue":t[12]||(t[12]=n=>J.value=n),doctype:"CRM Pipeline",docname:V.pipelineId,onAfter:t[13]||(t[13]=()=>{var n,C;(C=(n=h.value)==null?void 0:n.all_activities)==null||C.reload(),l(Pe)("attachments")})},null,8,["modelValue","docname"]),I.value?(i(),g(Ae,{key:3,modelValue:I.value,"onUpdate:modelValue":t[14]||(t[14]=n=>I.value=n),doctype:"CRM Pipeline",docname:V.pipelineId,name:"Pipelines"},null,8,["modelValue","docname"])):_("",!0)],64)}}};export{Fl as default};
//# sourceMappingURL=Pipeline-cab00b44.js.map
